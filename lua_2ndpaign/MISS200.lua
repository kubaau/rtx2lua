-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0000.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = 'Willkommen zur dritten Kampagne für die Siedler II - "Das Dominion"; Arbeitstitel: 2NDpaign!\nDiese Kampagne wurde, wie schon die FANpaign, von S2-Fans für S2-Fans erstellt. Die neue Kampagne beinhaltet 10 Mission unterschiedlichen Schwierigkeitsgrades - von leicht bis "sauschwer" - es gibt einige Nüsse zu knacken! Viel Spaß beim Lösen der Missionen!\n\nNatürlich ist es überflüssig zu sagen, daß mit Cheats u. anderen Mogeleien errungene Siege wertlos sind!\n\n\n\n\n\n\n\n\n\n\n',
        msg2    = 'I - Feuerland, von Jörg Scholl\n\n==============================\nNachricht aus Rom\n\nVor 14 Tagen ist der Norden des Imperiums von blutrünstigen Barbaren angegriffen worden! Viele unserer Landsleute sind getötet oder verschleppt worden! Euer Auftrag ist es, die Angreifer auszumachen und den Frieden wiederherzustellen! Viel Erfolg!\n\nPlinius Senator, anno domini 94\n==============================\n\n\n\n\n\n\n\n\n\n\n',
        msg4    = 'Tagebuch des Octavianus, 43. Tag im 1. Jahr:\n\nWir haben den Ort des heimtückischen Überfalls erreicht! Es ist furchtbar! Von den römischen Siedlungen in den Randprovinzen ist nichts übrig, von den Einwohnern fehlt jede Spur! Wir haben unsere Zelte im ehemaligen Zentrum der Provinz aufgeschlagen. Als erstes sollten wir die Umgebung erkunden; bei der Ausweitung sollten wir außerordentlich vorsichtig vorgehen...der Feind könnte noch in der Nähe sein... \n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Erkundet die Umgebung! Geht dabei äußerst vorsichtig vor!!! Der Platz zum Bauen ist begrenzt!',
        msg6    = 'Wir fanden die Baupläne für die Festung. Jetzt fühle ich mich schon wesentlich sicherer...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Setzt Euer neues Wissen sinnvoll ein...denkt an Eure Ressourcen!',
        msg8    = 'Wir trafen auf das Volk, das uns angegriffen hat...Nachdem wir den Anführer mit den Vorwürfen konfrontierten, sagte man uns nur, wir sollten uns in Acht nehmen; im Falle einer weiteren Annäherung an ihre Grenzen würde Krieg drohen...und dann drohten sie uns mit der Tatsache, daß das Ende des römischen Reiches nah sei. Den Grund für diese Annahme wollten sie uns allerdings nicht nennen...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Richtet Euch auf einen Kampf ein...',
        msg10   = 'Wir haben ein Tor erobert! Aufgrund unserer bisherigen Erfahrungen mit diesen Einrichtungen könnte es nicht schaden, es zu betreten...erst recht aufgrund der Tatsache, daß einige der Überlebenden des feindlichen Volkes ebenfalls beim Fliehen beobachtet wurden!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh10  = 'Folgt Euren Feinden!',
        msg12   = 'Einer unserer Männer fand im feindlichen Hauptquartier, genauer gesagt, in den Ruinen davon, die Baupläne für das Katapult! Jetzt können wir endlich auch passiven Widerstand leisten!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh12  = 'Sichert die Front(en)!',
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = 'Welcome to the third campaign for the Settlers II \n\n "The Dominion" aka 2NDpaign!\n\nThis campaign - as FANpaign before - has been compiled and created by S2 fans for S2 fans. The new campaign contains 10 missions of varying difficulty - ranging from easy to extra tough - there are some deep holes to dig! Enjoy the missions!\n\nNeedless to say, that victories won by cheating or unfair methods are not worth the wile!\n\n\n\n\n\n\n\n\n\n',
        msg2    = 'I - Fireland, by Jörg Scholl\n\n==============================\nNews from Rome:\n\nA fortnight ago the north of the empire has been invaded by bloodthirsty barbarians. Many of our citizens have been killed or abducted. Your mission is to seek out the enemy and restore peace. Good luck!\n\nPlinius Senator, anno domini 94\n==============================\n\n\n\n\n\n\n\n\n\n\n\n',
        msg4    = 'Diary of Octavius 43rd day of the 1st year:\n\nWe have reached the site of the malicious raid! It is horrible! There is nothing left of the roman settlements in the border provinces, there is no trace of their inhabitants. We pitched tents at the former centre of the province.\n\nFirst we should explore the area. We should expand with outmost care ... the enemy might still keep in hiding nearby ...\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Explore the surrounding area. Use extreme care doing this! Space for buildings is scarce.',
        msg6    = 'We have found blueprints for a fortress. Now I feel much more secure...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Make diligent use of your new knowledge ... always have in mind your scarce ressources.',
        msg8    = 'We encountered the tribe responsible for the raids ... Their leader, confronted with our accusations, only warned us to take care; further accessing their borders would mean war ... and they threatened that the end of the Roman Empire was at hand. A reason for this statement they were not prepared to name...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Prepare for a fight...',
        msg10   = 'We have occupied a Gate. Judging from experience with these contraptions, it should be wise to enter it ... even more since some survivors of the hostile tribe were observed fleeing there as well.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh10  = 'Follow your enemies.',
        msg12   = 'One of our men examined the ruins of the former headquarters of the enemy and has found blueprints for a Catapult. Now at last we are able to establish passive resistance.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh12  = 'Secure your border(s).',
        msg14   = 'Secure your frontiers!',
    },
})

function getNumPlayers()
    return 4
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_CATAPULTS_ATTACK_ALLIES, true)
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end

    rttr:GetPlayer(1):SetAI(3)
    rttr:GetPlayer(1):SetColor(1)
    rttr:GetPlayer(1):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(1):SetName('Knut')
 -- rttr:GetPlayer(1):SetPortrait(4)

    rttr:GetPlayer(2):SetAI(3)
    rttr:GetPlayer(2):SetColor(2)
    rttr:GetPlayer(2):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(2):SetName('Olof')
 -- rttr:GetPlayer(2):SetPortrait(5)

    rttr:GetPlayer(3):SetAI(3)
    rttr:GetPlayer(3):SetColor(3)
    rttr:GetPlayer(3):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(3):SetName('Erik')
 -- rttr:GetPlayer(3):SetPortrait(3)
end

function onStart(isFirstStart)
    -- world always commands
    rttr:GetWorld():SetComputerBarrier(12, 22, 9)

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableAllBuildings()
    rttr:GetPlayer(0):DisableBuilding(BLD_FORTRESS)
    rttr:GetPlayer(0):DisableBuilding(BLD_CATAPULT)
    rttr:GetPlayer(0):DisableBuilding(BLD_MINT)

    -- player 1 always commands
    rttr:GetPlayer(1):EnableAllBuildings()

    -- player 2 always commands
    rttr:GetPlayer(2):EnableAllBuildings()

    -- player 3 always commands
    rttr:GetPlayer(3):EnableAllBuildings()

    -- events which need to be triggered multiple times

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[ 1] = true
    activeEvents[ 2] = true
    activeEvents[ 3] = true
    activeEvents[ 4] = true
    activeEvents[ 5] = true
    activeEvents[ 6] = true
    activeEvents[30] = true
    activeEvents[99] = true

    if isFirstStart then
        -- world firststart commands
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(29, 90, SPEC_POLARBEAR)

        -- player 0 firststart commands
        rttr:GetPlayer(0):PlaceHQ(32, 87)
        rttr:GetPlayer(0):ClearResources()

        -- player 1 firststart commands
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(1):PlaceHQ(79, 64)
        rttr:GetPlayer(1):ClearResources()

        -- player 2 firststart commands
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(2):PlaceHQ(13, 25)
        rttr:GetPlayer(2):AIConstructionOrder(13, 28, BLD_FORTRESS)
        rttr:GetPlayer(2):AIConstructionOrder(16, 28, BLD_FORTRESS)
        rttr:GetPlayer(2):AIConstructionOrder(9, 25, BLD_FORTRESS)
        rttr:GetPlayer(2):AIConstructionOrder(16, 22, BLD_FORTRESS)
        rttr:GetPlayer(2):ClearResources()

        -- player 3 firststart commands
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(3):PlaceHQ(41, 14)
        rttr:GetPlayer(3):AIConstructionOrder(38, 16, BLD_FORTRESS)
        rttr:GetPlayer(3):AIConstructionOrder(43, 15, BLD_FORTRESS)
        rttr:GetPlayer(3):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 15,
            [GD_BOARDS    ] = 20,
            [GD_STONES    ] = 15,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 0,
            [GD_HAM       ] = 0,
            [GD_BREAD     ] = 0,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 0,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 1,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 1,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 4,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 1,
            [GD_RODANDLINE] = 2,
            [GD_SCYTHE    ] = 2,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 1,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 5,
        })

        -- player 1 wares
        rttr:GetPlayer(1):AddWares({
            [GD_WOOD      ] = 15,
            [GD_BOARDS    ] = 50,
            [GD_STONES    ] = 80,
            [GD_MEAT      ] = 12,
            [GD_GRAIN     ] = 12,
            [GD_FLOUR     ] = 12,
            [GD_FISH      ] = 12,
            [GD_HAM       ] = 12,
            [GD_BREAD     ] = 12,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 6,
            [GD_COAL      ] = 20,
            [GD_IRONORE   ] = 15,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 6,
            [GD_TONGS     ] = 3,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 6,
            [GD_SHOVEL    ] = 6,
            [GD_CRUCIBLE  ] = 2,
            [GD_RODANDLINE] = 3,
            [GD_SCYTHE    ] = 6,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 1,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 0,
        })

        -- player 2 wares
        rttr:GetPlayer(2):AddWares({
            [GD_WOOD      ] = 15,
            [GD_BOARDS    ] = 100,
            [GD_STONES    ] = 122,
            [GD_MEAT      ] = 40,
            [GD_GRAIN     ] = 40,
            [GD_FLOUR     ] = 50,
            [GD_FISH      ] = 50,
            [GD_HAM       ] = 50,
            [GD_BREAD     ] = 50,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 6,
            [GD_COAL      ] = 20,
            [GD_IRONORE   ] = 15,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 6,
            [GD_TONGS     ] = 3,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 6,
            [GD_SHOVEL    ] = 6,
            [GD_CRUCIBLE  ] = 2,
            [GD_RODANDLINE] = 3,
            [GD_SCYTHE    ] = 6,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 1,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 0,
        })

        -- player 3 wares
        rttr:GetPlayer(3):AddWares({
            [GD_WOOD      ] = 15,
            [GD_BOARDS    ] = 70,
            [GD_STONES    ] = 90,
            [GD_MEAT      ] = 20,
            [GD_GRAIN     ] = 25,
            [GD_FLOUR     ] = 30,
            [GD_FISH      ] = 30,
            [GD_HAM       ] = 30,
            [GD_BREAD     ] = 30,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 6,
            [GD_COAL      ] = 20,
            [GD_IRONORE   ] = 15,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 6,
            [GD_TONGS     ] = 3,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 6,
            [GD_SHOVEL    ] = 6,
            [GD_CRUCIBLE  ] = 2,
            [GD_RODANDLINE] = 3,
            [GD_SCYTHE    ] = 6,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 1,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 0,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 2,
            [JOB_FISHER           ] = 2,
            [JOB_FORESTER         ] = 1,
            [JOB_CARPENTER        ] = 1,
            [JOB_STONEMASON       ] = 2,
            [JOB_HUNTER           ] = 1,
            [JOB_FARMER           ] = 2,
            [JOB_MILLER           ] = 1,
            [JOB_BAKER            ] = 1,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 2,
            [JOB_BREWER           ] = 1,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 1,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 0,
            [JOB_BUILDER          ] = 6,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 22,
            [JOB_PRIVATEFIRSTCLASS] = 7,
            [JOB_SERGEANT         ] = 4,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 10,
            [JOB_SCOUT            ] = 6,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 12,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 1 people
        rttr:GetPlayer(1):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 6,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 9,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 6,
            [JOB_MILLER           ] = 2,
            [JOB_BAKER            ] = 2,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 6,
            [JOB_BREWER           ] = 1,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 22,
            [JOB_PRIVATEFIRSTCLASS] = 11,
            [JOB_SERGEANT         ] = 11,
            [JOB_OFFICER          ] = 6,
            [JOB_GENERAL          ] = 25,
            [JOB_SCOUT            ] = 6,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 35,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 2 people
        rttr:GetPlayer(2):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 6,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 9,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 6,
            [JOB_MILLER           ] = 2,
            [JOB_BAKER            ] = 2,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 6,
            [JOB_BREWER           ] = 1,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 35,
            [JOB_PRIVATEFIRSTCLASS] = 11,
            [JOB_SERGEANT         ] = 11,
            [JOB_OFFICER          ] = 6,
            [JOB_GENERAL          ] = 50,
            [JOB_SCOUT            ] = 6,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 35,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 3 people
        rttr:GetPlayer(3):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 6,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 9,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 6,
            [JOB_MILLER           ] = 2,
            [JOB_BAKER            ] = 2,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 6,
            [JOB_BREWER           ] = 1,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 15,
            [JOB_PRIVATEFIRSTCLASS] = 11,
            [JOB_SERGEANT         ] = 6,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 10,
            [JOB_SCOUT            ] = 6,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 35,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(0, 0)
        triggerEndEvent(1, 1)
        triggerEndEvent(2, 2)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 0 then
        showMissionText(0)
    elseif e == 1 then
        showMissionText(2)
    elseif e == 2 then
        showMissionText(4)
    elseif e == 3 then
        enableBuilding(BLD_FORTRESS)
    elseif e == 4 then
        enableBuilding(BLD_CATAPULT)
    elseif e == 6 then
        enableBuilding(BLD_MINT)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(22, 9, 561, 0xFFFF, 2)
    elseif e == 99 then
        activeEvents[98] = true
        showMissionText(10)
        rttr:SetCampaignChapterCompleted('2NDpaign', 1)
        rttr:EnableCampaignChapter('2NDpaign', 2)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[6] and rttr:GetPlayer(0):GetWareCount(GD_GOLD) >= 25 then
        triggerEndEvent(6, 6)
    end
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    elseif activeEvents[5] and ((p == 0 and o == 1) or (p == 1 and o == 0)) then
        showMissionText(8)
        triggerEndEvent(5, 5)
    end

    if p ~= 0 then return
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    elseif activeEvents[3] and x == 39 and y == 121 then
        showMissionText(6)
        triggerEndEvent(3, 3)
    elseif activeEvents[4] and x == 79 and y == 64 then
        showMissionText(12)
        triggerEndEvent(4, 4)
    elseif activeEvents[30] and x == 22 and y == 9 then
        triggerEndEvent(30, 30)
        triggerEndEvent(99, 30)
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    end
end

-- Generation end
