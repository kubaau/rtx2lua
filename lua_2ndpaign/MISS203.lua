-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0003.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = 'IV - Kaiserspiel, von Christoph Pallaske.\n\nWir waren zu langsam und sind in eine Sackgasse geraten. Diese Welt müssen wir durch das gleiche Tor verlassen, durch das wir sie auch betreten haben. \nDoch zum Aktivieren des Tores benötigen wir einen Schlüssel. Dieser wurde jedoch vor langer Zeit in 6 Teile zerlegt, und lagert seither in den Hauptquartieren der hier ansässigen Völker. Es gilt die Regel, dass jeder, der es schafft ein Hauptquartier zu erreichen, sich eine Kopie des jeweiligen Schlüssels machen darf. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Findet die Hauptquartiere und macht Euch die benötigten Kopien der Bruchstücke. Setzt die Teile zusammen, und aktiviert damit das Tor!\nBedenkt, nicht immer ist der kürzeste Weg auch der schnellste Weg!',
        msg2    = 'Ein Anfang ist getan.\n\nEs hat seine Zeit gedauert bis unsere Gelehrten, den ersten Bruchteil des Schlüssels aktivieren konnten.\n\nSo wie es aussieht können wir zwar die Bruchstücke in beliebiger Reihenfolge einsammeln, aktiviert werden  können sie jedoch nur der Reihe nach.\n\nEinmal gefundene Bruchstücke bleiben für immer in unserem Besitz! \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Sammelt die restlichen 5 Bruchstücke ein, und aktiviert sie. Das zerstören der Hauptquartiere ist nicht nötig, sie brauchen nur erreicht zu werden.',
        msg4    = 'Das zweite Bruchstück ist aktiviert! \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Sammelt die restlichen 4 Bruchstücke ein. Die Reihenfolge ist beliebig. ',
        msg6    = 'Das dritte Bruchstück ist aktiviert! \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Sammelt die restlichen 3 Bruchstücke ein!',
        msg8    = 'Das vierte Brushstück ist aktiviert! \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Sammelt die beiden verbleibenden Teile ein!',
        msg10   = 'Das vorletzte Bruchstück ist aktiviert! \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh10  = 'Aktiviert das letzte Bruchstück, und öffnet mit dem Schlüssel das Tor!',
        msg12   = 'Das letzte Bruchstück ist aktiviert.\n\nMit dem nun neu geschaffenen Schlüssel haben unsere Gelehrten das Tor erfolgreich aktivieren können! \n\nDamit ist der Beweis vollbracht:\nEs ist tatsächlich möglich, die Tore mit einem Schlüssel zu steuern; Wir sollten den Schlüssel aufbewahren. Vielleicht nützt er uns ja irgendwann einmal. Es gibt nur ein Problem:\nDas Ziel war bereits eingestellt. Die Gelehrten versuchen nun herauszufinden, wie wir selbst ein beliebiges Ziel einstellen können...\n\n\n\n\n\n\n\n\n\n',
        msgh12  = 'Ihr habt diese Mission erfolgreich bestanden! Betretet das Tor, und bewährt Euch in neuen Welten.',
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = "IV - King's Gambit, by Christoph Pallaske.\n\nWe were too slow and reached this dead end. We have to leave this world by the same Gate by which we entered it.\n\nBut, to activate the Gate we need a key. This key, however, was separated in six fragments ages ago and the fragments are kept in the headquarters of the peoples living here. There is the custom that he, who manages it to reach a HQ, is entitled to make a copy of the fragment kept there.\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh0   = "Find the HQs and get the copies of the key's parts. Put the fragments together and activate the Gate.\nBut mind, not always the shortest way will be the fastest.",
        msg2    = 'We have made a start.\n\nIt took some time until our scientists were able to make an exact copy of the first fragment of the key.\n\nIt looks like we can collect the keys at random but they can be fitted together in their proper sequence only.\n\nOnce found, the fragments will stay in our possession. \n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Collect the remaining fragments making exact copies. It will not be necessary to destoy the headquarters, reaching them will suffice. ',
        msg4    = 'We have a copy of the second fragment.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Collect the remaining fragments. Their sequence is not important. ',
        msg6    = 'Now the third fragment is ours.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Collect the remaining fragments.',
        msg8    = 'This is fragment number four. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Collect the remainig parts.',
        msg10   = 'This fragment is but the last one. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh10  = 'Get the remaining one, combine the fragments and activate the Gate.',
        msg12   = 'Now we have the last fragment.\n\nUsing the restored key our scientists have activated the Gate.\n\nThis is the proof:\nIt is possible indeed to command the Gates using a key; we should keep it. Maybe it will come in handy some time.\n\nThere is only one problem:\nThe destination was set already. The scientists now try to figure out how to set a destination of our own...\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh12  = 'Having succeeded in activating the Gate, go ahead and use it. New adventures are waiting for you.',
    },
})

function getNumPlayers()
    return 7
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_CATAPULTS_ATTACK_ALLIES, true)
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end

    rttr:GetPlayer(1):SetAI(3)
    rttr:GetPlayer(1):SetColor(1)
    rttr:GetPlayer(1):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(1):SetName('Olof')
 -- rttr:GetPlayer(1):SetPortrait(5)

    rttr:GetPlayer(2):SetAI(3)
    rttr:GetPlayer(2):SetColor(2)
    rttr:GetPlayer(2):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(2):SetName('Knut')
 -- rttr:GetPlayer(2):SetPortrait(4)

    rttr:GetPlayer(3):SetAI(3)
    rttr:GetPlayer(3):SetColor(3)
    rttr:GetPlayer(3):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(3):SetName('Erik')
 -- rttr:GetPlayer(3):SetPortrait(3)

    rttr:GetPlayer(4):SetAI(3)
    rttr:GetPlayer(4):SetColor(4)
    rttr:GetPlayer(4):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(4):SetName('Hakirawashi')
 -- rttr:GetPlayer(4):SetPortrait(8)

    rttr:GetPlayer(5):SetAI(3)
    rttr:GetPlayer(5):SetColor(5)
    rttr:GetPlayer(5):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(5):SetName('Tsunami')
 -- rttr:GetPlayer(5):SetPortrait(7)

    rttr:GetPlayer(6):SetAI(3)
    rttr:GetPlayer(6):SetColor(6)
    rttr:GetPlayer(6):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(6):SetName('Yamauchi')
 -- rttr:GetPlayer(6):SetPortrait(6)
end

function onStart(isFirstStart)
    -- world always commands

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableAllBuildings()

    -- player 1 always commands
    rttr:GetPlayer(1):EnableAllBuildings()

    -- player 2 always commands
    rttr:GetPlayer(2):EnableAllBuildings()

    -- player 3 always commands
    rttr:GetPlayer(3):EnableAllBuildings()

    -- player 4 always commands
    rttr:GetPlayer(4):EnableAllBuildings()

    -- player 5 always commands
    rttr:GetPlayer(5):EnableAllBuildings()

    -- player 6 always commands
    rttr:GetPlayer(6):EnableAllBuildings()

    -- events which need to be triggered multiple times

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[31] = true
    activeEvents[91] = true
    activeEvents[92] = true
    activeEvents[93] = true
    activeEvents[94] = true
    activeEvents[95] = true
    activeEvents[96] = true

    if isFirstStart then
        -- world firststart commands

        -- player 0 firststart commands
        rttr:GetPlayer(0):PlaceHQ(76, 80)
        rttr:GetPlayer(0):ClearResources()

        -- player 1 firststart commands
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(1):PlaceHQ(80, 23)
        rttr:GetPlayer(1):ClearResources()

        -- player 2 firststart commands
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(2):PlaceHQ(121, 61)
        rttr:GetPlayer(2):ClearResources()

        -- player 3 firststart commands
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(3):PlaceHQ(116, 98)
        rttr:GetPlayer(3):ClearResources()

        -- player 4 firststart commands
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(4):PlaceHQ(72, 108)
        rttr:GetPlayer(4):ClearResources()

        -- player 5 firststart commands
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(5):PlaceHQ(43, 109)
        rttr:GetPlayer(5):ClearResources()

        -- player 6 firststart commands
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(6):PlaceHQ(41, 37)
        rttr:GetPlayer(6):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 1 wares
        rttr:GetPlayer(1):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 2 wares
        rttr:GetPlayer(2):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 3 wares
        rttr:GetPlayer(3):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 4 wares
        rttr:GetPlayer(4):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 5 wares
        rttr:GetPlayer(5):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 6 wares
        rttr:GetPlayer(6):AddWares({
            [GD_WOOD      ] = 24,
            [GD_BOARDS    ] = 44,
            [GD_STONES    ] = 67,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 6,
            [GD_BREAD     ] = 8,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 16,
            [GD_IRONORE   ] = 16,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 2,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 2,
            [GD_HAMMER    ] = 16,
            [GD_SHOVEL    ] = 4,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 8,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 2,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 6,
            [GD_SHIELD    ] = 6,
            [GD_BOAT      ] = 12,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 52,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 1 people
        rttr:GetPlayer(1):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 2 people
        rttr:GetPlayer(2):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 3 people
        rttr:GetPlayer(3):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 4 people
        rttr:GetPlayer(4):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 5 people
        rttr:GetPlayer(5):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 6 people
        rttr:GetPlayer(6):AddPeople({
            [JOB_HELPER           ] = 20,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 0,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 4,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 0,
            [JOB_MILLER           ] = 0,
            [JOB_BAKER            ] = 0,
            [JOB_BUTCHER          ] = 0,
            [JOB_MINER            ] = 10,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 0,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 0,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 2,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 10,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(0, 0)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 0 then
        showMissionText(0)
    elseif e == 91 then
        activeEvents[32] = true
        showMissionText(2)
    elseif e == 92 then
        activeEvents[33] = true
        showMissionText(4)
    elseif e == 93 then
        activeEvents[34] = true
        showMissionText(6)
    elseif e == 94 then
        activeEvents[35] = true
        showMissionText(8)
    elseif e == 95 then
        activeEvents[36] = true
        showMissionText(10)
    elseif e == 96 then
        activeEvents[98] = true
        showMissionText(12)
        rttr:SetCampaignChapterCompleted('2NDpaign', 4)
        rttr:EnableCampaignChapter('2NDpaign', 5)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(77, 73, 561, 0xFFFF, 2)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    end

    if p ~= 0 then return
    elseif activeEvents[31] and x == 72 and y == 108 then
        triggerEndEvent(31, 31)
        triggerEndEvent(91, 31)
    elseif activeEvents[32] and x == 43 and y == 109 then
        triggerEndEvent(32, 32)
        triggerEndEvent(92, 32)
    elseif activeEvents[33] and x == 116 and y == 98 then
        triggerEndEvent(33, 33)
        triggerEndEvent(93, 33)
    elseif activeEvents[34] and x == 41 and y == 37 then
        triggerEndEvent(34, 34)
        triggerEndEvent(94, 34)
    elseif activeEvents[35] and x == 121 and y == 61 then
        triggerEndEvent(35, 35)
        triggerEndEvent(95, 35)
    elseif activeEvents[36] and x == 80 and y == 23 then
        triggerEndEvent(36, 36)
        triggerEndEvent(96, 36)
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    end
end

-- Generation end
