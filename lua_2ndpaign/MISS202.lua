-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0002.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = 'III - Im Eismeer, von Jörg Scholl\n\nAuch das noch:\nWir sind in einer Eiswüste gelandet! Späher berichteten von einem anderen Volk, das sich ebenfalls auf dieser Insel befindet. Es scheint uns nicht feindlich gesinnt zu sein, aber möglicherweise werden wir angreifen müssen, denn am anderen Ende der Insel scheint es einen magischen Ort zu geben, an dem wir schon verloren geglaubtes Wissen zurückerlangen können.\nHoffen wir das Beste...\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Haltet Ausschau nach möglichen Plätzen zum Hafenbau. Bedenkt:\nManchmal sieht man den Wald vor lauter Bäumen nicht!\n\nEinen weiteren magischen Ort werdet Ihr auf der "Insel des Kreises" finden!',
        msg2    = 'Wir konnten die Ausbildung von einigen Berufen beenden, außerdem haben unsere Gelehrten Baupläne entwickelt für:\n\n-die Holzfällerhütte,\n-die Wachstube,\n-die Baracke.\n\nLangsam, aber sicher erlangen wir einen gewissen Grad an Wissen und Weisheit zurück. Dies ist meine letzte Mission, und ich werde nicht zulassen, daß mein Scheitern das Ende des römischen Reiches bedeutet...wir werden die Angreifer finden und ausschalten!\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Breitet Euch so schnell als möglich aus; versucht Kontakt zu den Wikingern aufzunehmen; sie haben wichtige Informationen über die Angreifer für Euch! Legt Euch nicht direkt mit Euren chinesischen Nachbarn an!',
        msg4    = '11. Tag im 3. Jahr\n\nWir haben einige Informationen von den Chinesen erhalten. Sie sagten, daß sie einer großen und mächtigen Handelsallianz angehörten; von Angriffen auf die Römer wollten sie jedoch nichts gehört haben. Sie waren sehr freundlich, verweigerten uns aber dennoch den Zutritt zu dem magischen Ort. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Versucht den magischen Ort zu erreichen, ohne Krieg mit Euren Nachbarn zu beginnen!',
        msg6    = 'Wir haben es geschafft!\n\nDer magische Ort ist unser! Wir fanden hier die Pläne zum Bau einer Werft! Endlich können wir von dieser doch recht klein geratenen Insel verschwinden!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Errichtet Werft und Hafengebäude (falls noch nicht geschehen) und startet eine Expedition in Richtung der untergehenden Sonne!',
        msg8    = 'Wir trafen auf die Wikinger!\nSie sagten uns, der Feind, nach dem wir suchen, nenne sich "das Dominion" und sei sehr mächtig.\n\nIm Vertrauen erzählte uns ein weiser Mann, daß es tatsächlich eine Art "Schlüssel" für die Tore gäbe! Aber ehe er uns mehr sagen konnte, verschwand er auf rätselhafte Weise. Wir sollten herausfinden, ob wir einen solchen Schlüssel für unsere Zwecke nutzen könnten! Die Gelehrten sind bereits an der Sache dran!\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Ihr könnt nicht für jede Kleinigkeit irgendeine Hilfe erwarten! Von jetzt an solltet Ihr genug Übung haben, auch mal allein voranzukommen!!!',
        msg10   = 'Der zweite magische Ort enthielt die Baupläne für\n\n-die Festung.\n\nJetzt können wir unsere Grenzen endlich richtig befestigen!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msg12   = 'Tagebuch des Octavianus.\n\nAuf dieser Insel befinden sich zwei Angehörige des Dominion. Vielleicht finden wir endlich die Angreifer. Ein Schiffbrüchiger erzählte uns auch von einem Tor...so langsam glaube ich, daß das Dominion etwas mit diesen Toren zu tun hat; sie benutzen sie und scheinen sie sogar steuern zu können! Sie scheinen also sehr mächtig zu sein. Ich habe das Gefühl, daß meine Heimat in wesentlich größerer Gefahr ist, als ich dachte...\n\n\n\n\n\n\n\n\n\n\n\n',
        msg14   = 'Wir haben das Tor erobert... und schon wieder haben wir einige der Soldaten des Dominion beim Fliehen durch das Tor beobachtet.\nWir sollten schnell folgen, bevor das Tor sich schließt, damit wir an der gleichen Position landen wie die Angreifer.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh14  = "Und weiter geht's...",
        msg16   = 'Unsere Späher haben einen weiteren magischen Ort entdeckt. Eine Inschrift warnt:\n\n"Wer diesen Ort betritt, erlangt unglaubliche Weisheit. Aber wisset, Fremder, wer dieses Wissen erlangen möchte, geht ein Bündnis mit der Unterwelt ein. Ihr müßt euch entscheiden, was Euch wichtiger ist: Macht oder Ehre..."\n\nIch denke, unser nächster Schritt sollte wohl überlegt sein...\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh16  = 'Bedenkt sehr gut, wie Ihr weiter vorgehen wollt...',
        msg18   = 'Ihr habt Euch gegen das Gute entschieden und seid aus Macht- und Wissensgier ein Bündnis mit der Unterwelt eingegangen! Die Götter wenden sich von euch ab und Ihr werdet bestraft!!!\n\n\nIhr werdet bald merken, welchen schrecklichen Fehler Ihr begangen habt...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh18  = "Jetzt gibt's erst recht keine Hilfen mehr!!!",
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = "III - Winter , by Jörg Scholl\n\nAnd this on top of all:\nWe have landed in an arctic wasteland. Scouts report of another nation living on this same island. They don't seem to be hostile, but eventually we will have to fight them, for at the far end of the island there seems to be a magic spot where we can regain wisdom we have obviously lost.\nLets hope for the best ...\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh0   = 'Watch out for sites to build a harbour.\nBut mind: Sometimes you fail to see a forest for too many trees.\nYou\'ll find another magic place on the "Island of the Circle".',
        msg2    = 'We finished the acquisition of some trades, also our scientists developed plans for different buildings such as:\n\n- the  woodcutter,\n- a guard house\n- a barracks.\n\nSlowly but surely we regain a certain degree of knowledge and wisdom. This will be my last mission and I will not allow any failure of mine to bring about the end of the Roman Empire...we will find and destroy the agressors!\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = "As fast as possible enlarge your territory; try to contact the Vikings, for they have vital information on the aggressors. Don't quarrel directly with your Chinese neighbours!",
        msg4    = "Day 11 of the 3rd year\n\nWe got some information from the Chinese. They told that they are part of a large trade association; they deny to have heard of the aggressions on our land. \n\nThey were very friendly but didn't allow us to visit the magic site.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh4   = 'Try to reach the magic site without starting war on your neighbours.',
        msg6    = 'We did it!\n\nThe magic site is ours! Here we found the plans to build a shipyard. Now, finally, we can leave this island which has grown too small for us.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Build a shipyard and - if not done already - a harbour and start an expedition in direction of the setting sun.',
        msg8    = 'We met Vikings.\n\nThey told us the enemy we are looking for is called "The Dominion" and that it is very powerful.\n\nA wise man told us in confidence, that indeed there is a "key" of some sort to the Gates! But before he could tell us more, he had disappeared miraculously. We should find out whether we can put such a key to use for our own purposes. Our scientists already are occupied with this matter.\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Do not expect help in any small matter. From now on you should be experienced enough to use your own judgement!',
        msg10   = 'The second magic spot yielded the plans for\n\n- the fortress.\n\nNow we can fortify our borders effectively.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msg12   = 'Diary of Octavianus.\n\nOn this island there live two tribes of the Dominion. Perhaps we finally can find the aggressors. A survivor of a ship wreck also told us about a Gate ... \n\nBy and by I believe the Dominion has a hand in these Gates; they use them and even seem to be able to direct them. Also they seem to be very powerful. I have a feeling that my country is more deeply in trouble than anticipated ... \n\n\n\n\n\n\n\n\n\n\n\n\n',
        msg14   = 'We have occupied the Gate...and again we observed soldiers of the Dominion fleeing through it.\n\nWe should make haste to follow suit before the Gate closes again if we want to land in the same destination as the aggressors.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh14  = 'And on we go...',
        msg16   = 'Our scouts found another magic spot. An inscription warns:\n\n"He who sets foot on this spot will gain unbelievable wisdom. But beware, stranger, he who craves to gain this wisdom will unite with the World of Dark. It is up to your to decide what is more your desire: Power or Honour! " \n\nI think, our next step will take some consideration ... \n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh16  = 'Consider carefully, how you want to proceed...',
        msg18   = 'You have decided against the Good and out of greed for power and knowledge you united with the World of Dark. The Gods will turn their backs on you and you will be punished!!!\n\n\nSoon you will become aware of what terrible sin you have committed...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh18  = 'And there will be no more support from now on...',
    },
})

function getNumPlayers()
    return 5
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_CATAPULTS_ATTACK_ALLIES, true)
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end

    rttr:GetPlayer(1):SetAI(3)
    rttr:GetPlayer(1):SetColor(1)
    rttr:GetPlayer(1):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(1):SetName('Olof')
 -- rttr:GetPlayer(1):SetPortrait(5)

    rttr:GetPlayer(2):SetAI(3)
    rttr:GetPlayer(2):SetColor(2)
    rttr:GetPlayer(2):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(2):SetName('Tsunami')
 -- rttr:GetPlayer(2):SetPortrait(7)

    rttr:GetPlayer(3):SetAI(3)
    rttr:GetPlayer(3):SetColor(3)
    rttr:GetPlayer(3):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(3):SetName('Yamauchi')
 -- rttr:GetPlayer(3):SetPortrait(6)

    rttr:GetPlayer(4):SetAI(3)
    rttr:GetPlayer(4):SetColor(4)
    rttr:GetPlayer(4):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(4):SetName('Hakirawashi')
 -- rttr:GetPlayer(4):SetPortrait(8)
end

function onStart(isFirstStart)
    -- world always commands
    rttr:GetWorld():SetComputerBarrier(20, 29, 92)
    rttr:GetWorld():SetComputerBarrier(20, 73, 150)

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableAllBuildings()
    rttr:GetPlayer(0):DisableBuilding(BLD_FORTRESS)
    rttr:GetPlayer(0):DisableBuilding(BLD_GUARDHOUSE)
    rttr:GetPlayer(0):DisableBuilding(BLD_BARRACKS)
    rttr:GetPlayer(0):DisableBuilding(BLD_SHIPYARD)
    rttr:GetPlayer(0):DisableBuilding(BLD_WOODCUTTER)

    -- player 1 always commands
    rttr:GetPlayer(1):EnableAllBuildings()

    -- player 2 always commands
    rttr:GetPlayer(2):EnableAllBuildings()

    -- player 3 always commands
    rttr:GetPlayer(3):EnableAllBuildings()

    -- player 4 always commands
    rttr:GetPlayer(4):EnableAllBuildings()

    -- events which need to be triggered multiple times

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[ 1] = true
    activeEvents[ 2] = true
    activeEvents[ 3] = true
    activeEvents[ 4] = true
    activeEvents[ 5] = true
    activeEvents[ 6] = true
    activeEvents[ 7] = true
    activeEvents[ 8] = true
    activeEvents[ 9] = true
    activeEvents[30] = true
    activeEvents[99] = true

    if isFirstStart then
        -- world firststart commands

        -- player 0 firststart commands
        rttr:GetPlayer(0):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(0):PlaceHQ(51, 26)
        rttr:GetPlayer(0):ClearResources()

        -- player 1 firststart commands
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(1):PlaceHQ(13, 56)
        rttr:GetPlayer(1):ClearResources()

        -- player 2 firststart commands
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(2):PlaceHQ(77, 60)
        rttr:GetPlayer(2):ClearResources()

        -- player 3 firststart commands
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(3):PlaceHQ(152, 108)
        rttr:GetPlayer(3):ClearResources()

        -- player 4 firststart commands
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(4):PlaceHQ(132, 130)
        rttr:GetPlayer(4):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 10,
            [GD_BOARDS    ] = 25,
            [GD_STONES    ] = 25,
            [GD_MEAT      ] = 25,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 10,
            [GD_HAM       ] = 5,
            [GD_BREAD     ] = 9,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 30,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 2,
            [GD_TONGS     ] = 1,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 4,
            [GD_PICKAXE   ] = 5,
            [GD_HAMMER    ] = 6,
            [GD_SHOVEL    ] = 6,
            [GD_CRUCIBLE  ] = 2,
            [GD_RODANDLINE] = 3,
            [GD_SCYTHE    ] = 3,
            [GD_CLEAVER   ] = 1,
            [GD_ROLLINGPIN] = 1,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 10,
            [GD_SHIELD    ] = 10,
            [GD_BOAT      ] = 0,
        })

        -- player 1 wares
        rttr:GetPlayer(1):AddWares({
            [GD_WOOD      ] = 25,
            [GD_BOARDS    ] = 30,
            [GD_STONES    ] = 30,
            [GD_MEAT      ] = 20,
            [GD_GRAIN     ] = 20,
            [GD_FLOUR     ] = 20,
            [GD_FISH      ] = 20,
            [GD_HAM       ] = 20,
            [GD_BREAD     ] = 20,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 0,
            [GD_COAL      ] = 0,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 10,
            [GD_TONGS     ] = 2,
            [GD_AXE       ] = 4,
            [GD_SAW       ] = 1,
            [GD_PICKAXE   ] = 4,
            [GD_HAMMER    ] = 6,
            [GD_SHOVEL    ] = 6,
            [GD_CRUCIBLE  ] = 2,
            [GD_RODANDLINE] = 1,
            [GD_SCYTHE    ] = 5,
            [GD_CLEAVER   ] = 2,
            [GD_ROLLINGPIN] = 1,
            [GD_BOW       ] = 1,
            [GD_SWORD     ] = 10,
            [GD_SHIELD    ] = 10,
            [GD_BOAT      ] = 0,
        })

        -- player 2 wares
        rttr:GetPlayer(2):AddWares({
            [GD_WOOD      ] = 50,
            [GD_BOARDS    ] = 40,
            [GD_STONES    ] = 40,
            [GD_MEAT      ] = 40,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 30,
            [GD_HAM       ] = 30,
            [GD_BREAD     ] = 30,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 12,
            [GD_COAL      ] = 12,
            [GD_IRONORE   ] = 20,
            [GD_GOLD      ] = 20,
            [GD_IRON      ] = 20,
            [GD_COINS     ] = 15,
            [GD_TONGS     ] = 2,
            [GD_AXE       ] = 9,
            [GD_SAW       ] = 4,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 12,
            [GD_SHOVEL    ] = 12,
            [GD_CRUCIBLE  ] = 5,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 12,
            [GD_CLEAVER   ] = 6,
            [GD_ROLLINGPIN] = 3,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 20,
            [GD_SHIELD    ] = 20,
            [GD_BOAT      ] = 0,
        })

        -- player 3 wares
        rttr:GetPlayer(3):AddWares({
            [GD_WOOD      ] = 50,
            [GD_BOARDS    ] = 40,
            [GD_STONES    ] = 40,
            [GD_MEAT      ] = 40,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 30,
            [GD_HAM       ] = 30,
            [GD_BREAD     ] = 30,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 12,
            [GD_COAL      ] = 12,
            [GD_IRONORE   ] = 20,
            [GD_GOLD      ] = 20,
            [GD_IRON      ] = 20,
            [GD_COINS     ] = 15,
            [GD_TONGS     ] = 2,
            [GD_AXE       ] = 9,
            [GD_SAW       ] = 4,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 12,
            [GD_SHOVEL    ] = 12,
            [GD_CRUCIBLE  ] = 5,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 12,
            [GD_CLEAVER   ] = 6,
            [GD_ROLLINGPIN] = 3,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 20,
            [GD_SHIELD    ] = 20,
            [GD_BOAT      ] = 0,
        })

        -- player 4 wares
        rttr:GetPlayer(4):AddWares({
            [GD_WOOD      ] = 50,
            [GD_BOARDS    ] = 40,
            [GD_STONES    ] = 40,
            [GD_MEAT      ] = 40,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 30,
            [GD_HAM       ] = 30,
            [GD_BREAD     ] = 30,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 12,
            [GD_COAL      ] = 12,
            [GD_IRONORE   ] = 20,
            [GD_GOLD      ] = 20,
            [GD_IRON      ] = 20,
            [GD_COINS     ] = 15,
            [GD_TONGS     ] = 2,
            [GD_AXE       ] = 9,
            [GD_SAW       ] = 4,
            [GD_PICKAXE   ] = 12,
            [GD_HAMMER    ] = 12,
            [GD_SHOVEL    ] = 12,
            [GD_CRUCIBLE  ] = 5,
            [GD_RODANDLINE] = 6,
            [GD_SCYTHE    ] = 12,
            [GD_CLEAVER   ] = 6,
            [GD_ROLLINGPIN] = 3,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 20,
            [GD_SHIELD    ] = 20,
            [GD_BOAT      ] = 0,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 2,
            [JOB_FISHER           ] = 1,
            [JOB_FORESTER         ] = 2,
            [JOB_CARPENTER        ] = 1,
            [JOB_STONEMASON       ] = 3,
            [JOB_HUNTER           ] = 1,
            [JOB_FARMER           ] = 3,
            [JOB_MILLER           ] = 1,
            [JOB_BAKER            ] = 2,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 5,
            [JOB_BREWER           ] = 1,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 1,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 0,
            [JOB_ARMORER          ] = 1,
            [JOB_BUILDER          ] = 6,
            [JOB_PLANER           ] = 2,
            [JOB_GEOLOGIST        ] = 4,
            [JOB_PRIVATE          ] = 15,
            [JOB_PRIVATEFIRSTCLASS] = 9,
            [JOB_SERGEANT         ] = 6,
            [JOB_OFFICER          ] = 6,
            [JOB_GENERAL          ] = 2,
            [JOB_SCOUT            ] = 2,
            [JOB_SHIPWRIGHT       ] = 1,
            [JOB_PACKDONKEY       ] = 16,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 1 people
        rttr:GetPlayer(1):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 2,
            [JOB_FISHER           ] = 3,
            [JOB_FORESTER         ] = 2,
            [JOB_CARPENTER        ] = 1,
            [JOB_STONEMASON       ] = 3,
            [JOB_HUNTER           ] = 1,
            [JOB_FARMER           ] = 2,
            [JOB_MILLER           ] = 1,
            [JOB_BAKER            ] = 1,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 2,
            [JOB_BREWER           ] = 2,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 1,
            [JOB_IRONFOUNDER      ] = 1,
            [JOB_MINTER           ] = 1,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 1,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 5,
            [JOB_GEOLOGIST        ] = 3,
            [JOB_PRIVATE          ] = 20,
            [JOB_PRIVATEFIRSTCLASS] = 9,
            [JOB_SERGEANT         ] = 6,
            [JOB_OFFICER          ] = 6,
            [JOB_GENERAL          ] = 6,
            [JOB_SCOUT            ] = 4,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 20,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 2 people
        rttr:GetPlayer(2):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 12,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 12,
            [JOB_HUNTER           ] = 4,
            [JOB_FARMER           ] = 12,
            [JOB_MILLER           ] = 3,
            [JOB_BAKER            ] = 3,
            [JOB_BUTCHER          ] = 6,
            [JOB_MINER            ] = 12,
            [JOB_BREWER           ] = 2,
            [JOB_PIGBREEDER       ] = 2,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 35,
            [JOB_SERGEANT         ] = 25,
            [JOB_OFFICER          ] = 15,
            [JOB_GENERAL          ] = 15,
            [JOB_SCOUT            ] = 9,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 50,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 3 people
        rttr:GetPlayer(3):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 12,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 12,
            [JOB_HUNTER           ] = 4,
            [JOB_FARMER           ] = 12,
            [JOB_MILLER           ] = 3,
            [JOB_BAKER            ] = 3,
            [JOB_BUTCHER          ] = 6,
            [JOB_MINER            ] = 12,
            [JOB_BREWER           ] = 2,
            [JOB_PIGBREEDER       ] = 2,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 35,
            [JOB_SERGEANT         ] = 25,
            [JOB_OFFICER          ] = 15,
            [JOB_GENERAL          ] = 15,
            [JOB_SCOUT            ] = 9,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 50,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 4 people
        rttr:GetPlayer(4):AddPeople({
            [JOB_HELPER           ] = 99,
            [JOB_WOODCUTTER       ] = 12,
            [JOB_FISHER           ] = 6,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 12,
            [JOB_HUNTER           ] = 4,
            [JOB_FARMER           ] = 12,
            [JOB_MILLER           ] = 3,
            [JOB_BAKER            ] = 3,
            [JOB_BUTCHER          ] = 6,
            [JOB_MINER            ] = 12,
            [JOB_BREWER           ] = 2,
            [JOB_PIGBREEDER       ] = 2,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 2,
            [JOB_BUILDER          ] = 12,
            [JOB_PLANER           ] = 12,
            [JOB_GEOLOGIST        ] = 6,
            [JOB_PRIVATE          ] = 45,
            [JOB_PRIVATEFIRSTCLASS] = 35,
            [JOB_SERGEANT         ] = 25,
            [JOB_OFFICER          ] = 15,
            [JOB_GENERAL          ] = 15,
            [JOB_SCOUT            ] = 9,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 50,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(0, 0)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 0 then
        showMissionText(0)
    elseif e == 1 then
        enableBuilding(BLD_WOODCUTTER)
        enableBuilding(BLD_BARRACKS)
        enableBuilding(BLD_GUARDHOUSE)
    elseif e == 3 then
        enableBuilding(BLD_SHIPYARD)
    elseif e == 5 then
        enableBuilding(BLD_FORTRESS)
    elseif e == 9 then
        activeEvents[10] = true
        activeEvents[20] = true
        showMissionText(18)
    elseif e == 10 then
        rttr:GetWorld():AddStaticObject(51, 26, 511, 0xFFFF, 1)
    elseif e == 20 then
        rttr:GetWorld():AddStaticObject(73, 150, 511, 0xFFFF, 1)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(161, 56, 561, 0xFFFF, 2)
    elseif e == 99 then
        activeEvents[98] = true
        showMissionText(14)
        rttr:SetCampaignChapterCompleted('2NDpaign', 3)
        rttr:EnableCampaignChapter('2NDpaign', 4)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[1] and rttr:GetPlayer(0):GetBuildingCount(BLD_WATCHTOWER) >= 1 then
        showMissionText(2)
        triggerEndEvent(1, 1)
    end
    if activeEvents[10] then
        triggerEndEvent(10, 10)
    end
    if activeEvents[20] then
        triggerEndEvent(20, 20)
    end
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    elseif activeEvents[2] and ((p == 0 and o == 2) or (p == 2 and o == 0)) then
        showMissionText(4)
        triggerEndEvent(2, 2)
    elseif activeEvents[4] and ((p == 0 and o == 1) or (p == 1 and o == 0)) then
        showMissionText(8)
        triggerEndEvent(4, 4)
    end

    if p ~= 0 then return
    elseif activeEvents[6] and x == 73 and y == 150 then
        showMissionText(12)
        triggerEndEvent(6, 6)
    elseif activeEvents[7] and x == 105 and y == 145 then
        showMissionText(16)
        triggerEndEvent(7, 7)
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    elseif activeEvents[3] and x == 97 and y == 49 then
        showMissionText(6)
        triggerEndEvent(3, 3)
    elseif activeEvents[5] and x == 13 and y == 44 then
        showMissionText(10)
        triggerEndEvent(5, 5)
    elseif activeEvents[8] and x == 105 and y == 145 then
        triggerEndEvent(8, 8)
        triggerEndEvent(9, 8)
    elseif activeEvents[30] and x == 161 and y == 56 then
        triggerEndEvent(30, 30)
        triggerEndEvent(99, 30)
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    end
end

-- Generation end
