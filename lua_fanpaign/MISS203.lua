-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0003.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = 'Im Ewigen Eis - Mission von Ralf Eggeling\n\nDie Freveltaten unserer Abtrünnigen haben den Zorn der Götter noch vergrößert. Wir fanden uns in einer noch unwirtlicheren Welt wieder. In eisiger Kälte, es scheint so, als würden wir nie wieder Gnade bei den Göttern finden! Auch haben uns die Götter wieder die Baupläne für 2 Gebäudetypen vorenthalten.\n- Keine Katapulte!\n- Keine Festung!\nWomit sollen wir uns dann verteidigen. Hoffen wir, daß es nur friedliche Nachbarn gibt. Wenigstens ausreichend Nahrung und Werkzeug haben wir erhalten.\n\nSuchen wir also erneut das Tor. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Erkunde die Gegend, und suche nach einem Hafenbauplatz! Die Bestände sind derzeit reichlich, doch überprüfe sie regelmäsig!',
        msg2    = 'Späher haben im Südosten einen günstigen Platz zum Bauen eines Hafens entdeckt! Wir sollten ihn unbedingt nutzen.\n\nScheinbar haben auch unsere Opfer etwas bewirkt. Einige der Götter scheinen uns wieder wohlgesonnen. Von Ihnen haben wir erfahren, daß es in dieser Welt Inseln mit Quellen der Erkenntnis gibt. Auch soll sich das Tor auf einer Insel befinden, doch betreten kann es nur der, der zuvor die Quellen der Erkenntnis aufgesucht hat.\nWarum auch immer...\n\nMehr konnten wir nicht in Erfahrung bringen.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Baue einen Hafen und eine Werft. Baue ein großes Schiff, und starte eine Expedition. Bedenke aber stets - unnütze Häfen können tödlicher Ballast sein! Befreie Dich rechtzeitig von ihnen. ',
        msg4    = 'Ein weiterer Hafenbauplatz wurde gesichtet.\nUnd diesmal, so schient es, ist es ein großer Ozean den es zu erkunden gibt. Doch wir sind zuversichtlich. Von Zeit zu Zeit bekommen wir wichtige Hinweise, von den wenigen, uns wieder wohlgesonnenen Göttern.\nNoch gilt es zwar, alle wichtigen Götter wieder auf uns gut einzustimmen, doch ein sichtbarer Anfang ist bereits getan.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Nutze den Hafenbauplatz, und suche nach den Quellen der Erkenntnis! Trinke aus ihnen, und warte ab, was geschieht.',
        msg6    = 'Ein Quell der Erkenntnis ist erreicht!\n\nDie Götter haben uns nicht getäuscht! Wir fanden die Baupläne für\n\n- Die Festung -\n\n in ihm. Wollen wir den Göttern ein weiters Opfer darbringen!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Nutze das wiedererlangte Wissen sinnvoll! Mit einer Festung kann man die Landesgrenzen sinnvoll verteidigen. Auch erreicht man durch sie den größten Landgewinn. ',
        msg8    = 'Ein Quell der Erkenntnis ist erreicht!\n\nDie Götter haben uns nicht getäuscht! Wir fanden die Baupläne für\n\n- Das Katapult -\n\nin ihm. Wollen wir den Göttern ein weiters Opfer darbringen!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh8   = 'Nutze das wiedererlangte Wissen sinnvoll! Achte aber auf den Steinbestand!',
        msg10   = 'Wir stehen vor einer großen Eisbarriere, es wird schwierig werden diese zu überqueren. Doch alle Zeichen deuten darauf hin, daß sich hinter der Eisbarriere das Tor befindet. Wollen wir eine günstige Stelle zum Überqueren suchen.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@',
        msgh10  = 'Baue so nah als möglich eine Festung an die Eisbarriere. Nur sie wird ein weiterkommen ermöglichen!',
        msg12   = 'Das Tor ist wieder erreicht!\n\nMeine Männer drängen darauf es zu betreten. Alle hoffen darauf, daß sich der Zorn der Götter gelegt hat. Eines scheint sicher - schlimmer als wie in dieser Welt kann es uns nicht mehr treffen. Wenn wenigstens die eisige Kälte nicht wäre, an das difuse Licht der letzten beiden Welten könnte man sich ja noch gewöhnen - aber diese Kälte... einfach unerträglich!\nUns bleibt also die große Hoffnung auf...\n\nDen Götteren haben wir auf jeden Fall häufig und reichlich geopfert, wollen wir sehen ob sich Gnade erkennen läßt!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh12  = 'Sie haben diese Mission erfüllt. Das nächste Kapitel wartet schon schon mit neuen Aufgaben auf Sie!',
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = "Deep Freeze\nMission by Ralf Eggeling\n\nThe outrages  committed by the renegades have increased the wrath of the Gods. We wound up in a world still more uncomfortable, in icy cold. It seems, we will never regain the grace of the Gods! They also again witheld the plans of two important buildings:\n - no catapults!\n - no fortresses!\nHow are we to defend ourselves? Let's hope, there are friendly neigbours only! At least we have been sufficiently been supplied with food and tools.\n\nSo let us search for The Arc again.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh0   = 'Explore the vicinity and search for a harbour! Even if your supplies are ample, check them regularly!',
        msg2    = 'Scouts have found an apt place to build a harbour in the Southeast! We shold make use of it by all means.\n\nPresumably our offerings have brought about at least something. Some of the Gods seem to be in our favor. They revealed, that in this world there are islands, having Wells of Wisdom. The Arc is supposed to be on an island, too, but only he, who has visited the Wells of Wisdom may access it.\n\nWhatever ...\n\nWe were unable to find out more.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Build a harbour and a shipyard.Build a large vessel and start an expedition. But always bear in mind, that unneccesary harbours can be a lethal ballast! \nRid yourself of them at the \nright time!',
        msg4    = 'Again a harbour place was detected.\nAnd now a large ocean seems to wait for exploration. We are confident. Off and on we receive hints by one of the few Deitys in favour of us again.\n\nYet we have to placate all of the more important Gods, but we made a good start already.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Make use of the harbour and search for the Wells of Wisdom! Drink from them and see, what will happen.',
        msg6    = "We reached a Well of Wisdom!\n\nThe Gods haven't deceived us! Next to the Well we have found the plans for\n\n - The fortress -\n\nLets offer to the Gods in our thankfulness!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh6   = 'Use the regained knowledge wisely! A fortress may effectivly protect your borders. It also allows maximum territorial gain.',
        msg8    = "We reached a Well of Wisdom!\n\nThe Gods haven't deceived us! Next to the Well we have found the plans for\n\n - The catapult -\n\nLets offer to the Gods in our thankfulness!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh8   = 'Use the regained knowledge wisely! But watch your supply of stones!',
        msg10   = "We are stopped by an immense ice barrier, which will be difficult to cross.\n\nBut all prophecies point out, that The Arc is hidden behind it. \n\nLet's search for a suitable pass to cross it. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@",
        msgh10  = 'Build a fortress as near as possible to the ice barrier. Only thus you will be able to proceed!',
        msg12   = "The Arc is reached!\n\nMy men are eager to proceed. Everybody hopes, that the wrath of the Gods has subsided. One thing, however, seems to be clear - we will never encounter anything worse than this world. If it wasn't for this icy cold, we could as in the previous two worlds adapt to the diffuse light - but this burning, icy cold ... simply intolerable!\nOnly hope keeps our morale up ...\n\nWe have offered, however, amply and often to the Gods, we will see, if they will show mercy!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        msgh12  = 'You have fulfilled this mission. The next chapter awaits you with a new quest!',
    },
})

function getNumPlayers()
    return 7
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end

    rttr:GetPlayer(1):SetAI(3)
    rttr:GetPlayer(1):SetColor(1)
    rttr:GetPlayer(1):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(1):SetName('Tsunami')
 -- rttr:GetPlayer(1):SetPortrait(7)

    rttr:GetPlayer(2):SetAI(3)
    rttr:GetPlayer(2):SetColor(2)
    rttr:GetPlayer(2):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(2):SetName('Yamauchi')
 -- rttr:GetPlayer(2):SetPortrait(6)

    rttr:GetPlayer(3):SetAI(3)
    rttr:GetPlayer(3):SetColor(3)
    rttr:GetPlayer(3):SetNation(NAT_JAPANESE)
    rttr:GetPlayer(3):SetName('Hakirawashi')
 -- rttr:GetPlayer(3):SetPortrait(8)

    rttr:GetPlayer(4):SetAI(3)
    rttr:GetPlayer(4):SetColor(4)
    rttr:GetPlayer(4):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(4):SetName('Olof')
 -- rttr:GetPlayer(4):SetPortrait(5)

    rttr:GetPlayer(5):SetAI(3)
    rttr:GetPlayer(5):SetColor(5)
    rttr:GetPlayer(5):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(5):SetName('Knut')
 -- rttr:GetPlayer(5):SetPortrait(4)

    rttr:GetPlayer(6):SetAI(3)
    rttr:GetPlayer(6):SetColor(6)
    rttr:GetPlayer(6):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(6):SetName('Erik')
 -- rttr:GetPlayer(6):SetPortrait(3)
end

function onStart(isFirstStart)
    -- world always commands
    rttr:GetWorld():SetComputerBarrier(13, 25, 33)
    rttr:GetWorld():SetComputerBarrier(13, 65, 51)
    rttr:GetWorld():SetComputerBarrier(13, 131, 20)
    rttr:GetWorld():SetComputerBarrier(15, 52, 129)
    rttr:GetWorld():SetComputerBarrier(13, 127, 111)
    rttr:GetWorld():SetComputerBarrier(13, 117, 180)
    rttr:GetWorld():SetComputerBarrier(13, 220, 67)
    rttr:GetWorld():SetComputerBarrier(13, 53, 25)
    rttr:GetWorld():SetComputerBarrier(13, 193, 176)
    rttr:GetWorld():SetComputerBarrier(13, 193, 194)

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableAllBuildings()
    rttr:GetPlayer(0):DisableBuilding(BLD_FORTRESS)
    rttr:GetPlayer(0):DisableBuilding(BLD_CATAPULT)

    -- player 1 always commands
    rttr:GetPlayer(1):EnableAllBuildings()

    -- player 2 always commands
    rttr:GetPlayer(2):EnableAllBuildings()

    -- player 3 always commands
    rttr:GetPlayer(3):EnableAllBuildings()

    -- player 4 always commands
    rttr:GetPlayer(4):EnableAllBuildings()

    -- player 5 always commands
    rttr:GetPlayer(5):EnableAllBuildings()

    -- player 6 always commands
    rttr:GetPlayer(6):EnableAllBuildings()

    -- events which need to be triggered multiple times

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[ 1] = true
    activeEvents[ 2] = true
    activeEvents[ 3] = true
    activeEvents[ 4] = true
    activeEvents[ 5] = true
    activeEvents[23] = true
    activeEvents[30] = true
    activeEvents[50] = true
    activeEvents[99] = true

    if isFirstStart then
        -- world firststart commands

        -- player 0 firststart commands
        rttr:GetPlayer(0):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(0):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(0):MakeOneSidedAllianceTo(3)
        rttr:GetPlayer(0):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(0):PlaceHQ(15, 29)
        rttr:GetPlayer(0):ClearResources()

        -- player 1 firststart commands
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(1):ClearResources()

        -- player 2 firststart commands
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(2):ClearResources()

        -- player 3 firststart commands
        rttr:GetPlayer(3):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(3):ClearResources()

        -- player 4 firststart commands
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(4):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(4):ClearResources()

        -- player 5 firststart commands
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(6)
        rttr:GetPlayer(5):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(5):ClearResources()

        -- player 6 firststart commands
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(5)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(4)
        rttr:GetPlayer(6):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(6):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 40,
            [GD_BOARDS    ] = 60,
            [GD_STONES    ] = 50,
            [GD_MEAT      ] = 20,
            [GD_GRAIN     ] = 20,
            [GD_FLOUR     ] = 30,
            [GD_FISH      ] = 30,
            [GD_HAM       ] = 20,
            [GD_BREAD     ] = 20,
            [GD_WATER     ] = 10,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 20,
            [GD_IRONORE   ] = 10,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 4,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 4,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 1 wares
        rttr:GetPlayer(1):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 2 wares
        rttr:GetPlayer(2):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 3 wares
        rttr:GetPlayer(3):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 4 wares
        rttr:GetPlayer(4):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 5 wares
        rttr:GetPlayer(5):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 6 wares
        rttr:GetPlayer(6):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 120,
            [GD_STONES    ] = 220,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 40,
            [GD_HAM       ] = 40,
            [GD_BREAD     ] = 40,
            [GD_WATER     ] = 0,
            [GD_BEER      ] = 40,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 25,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 100,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 4,
            [JOB_FORESTER         ] = 3,
            [JOB_CARPENTER        ] = 3,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 4,
            [JOB_MILLER           ] = 2,
            [JOB_BAKER            ] = 3,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 12,
            [JOB_BREWER           ] = 2,
            [JOB_PIGBREEDER       ] = 2,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 3,
            [JOB_MINTER           ] = 0,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 1,
            [JOB_BUILDER          ] = 4,
            [JOB_PLANER           ] = 6,
            [JOB_GEOLOGIST        ] = 8,
            [JOB_PRIVATE          ] = 40,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 4,
            [JOB_SHIPWRIGHT       ] = 3,
            [JOB_PACKDONKEY       ] = 0,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 1 people
        rttr:GetPlayer(1):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 20,
            [JOB_PRIVATEFIRSTCLASS] = 1,
            [JOB_SERGEANT         ] = 1,
            [JOB_OFFICER          ] = 1,
            [JOB_GENERAL          ] = 40,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 2 people
        rttr:GetPlayer(2):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 40,
            [JOB_PRIVATEFIRSTCLASS] = 1,
            [JOB_SERGEANT         ] = 1,
            [JOB_OFFICER          ] = 1,
            [JOB_GENERAL          ] = 50,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 3 people
        rttr:GetPlayer(3):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 30,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 5,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 3,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 4 people
        rttr:GetPlayer(4):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 30,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 5,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 3,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 5 people
        rttr:GetPlayer(5):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 30,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 5,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 3,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 6 people
        rttr:GetPlayer(6):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 20,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 10,
            [JOB_CARPENTER        ] = 10,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 20,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 10,
            [JOB_BUTCHER          ] = 10,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 10,
            [JOB_PIGBREEDER       ] = 8,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 6,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 5,
            [JOB_PLANER           ] = 10,
            [JOB_GEOLOGIST        ] = 10,
            [JOB_PRIVATE          ] = 30,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 5,
            [JOB_OFFICER          ] = 4,
            [JOB_GENERAL          ] = 3,
            [JOB_SCOUT            ] = 10,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 40,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(0, 0)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 0 then
        showMissionText(0)
    elseif e == 3 then
        enableBuilding(BLD_FORTRESS)
    elseif e == 4 then
        enableBuilding(BLD_CATAPULT)
    elseif e == 50 then
        rttr:GetWorld():AddStaticObject(249, 161, 560, 0xFFFF, 2)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(249, 161, 561, 0xFFFF, 2)
    elseif e == 99 then
        activeEvents[98] = true
        showMissionText(12)
        rttr:SetCampaignChapterCompleted('fanpaign', 4)
        rttr:EnableCampaignChapter('fanpaign', 5)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[1] and rttr:GetPlayer(0).GetStatisticsValue ~= nil and rttr:GetPlayer(0):GetStatisticsValue(STAT_COUNTRY) >= 300 then
        showMissionText(2)
        triggerEndEvent(1, 1)
    end
    if activeEvents[50] then
        triggerEndEvent(50, 50)
    end
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    end

    if p ~= 0 then return
    elseif activeEvents[2] and x == 131 and y == 20 then
        showMissionText(4)
        triggerEndEvent(2, 2)
    elseif activeEvents[3] and x == 244 and y == 13 then
        showMissionText(6)
        triggerEndEvent(3, 3)
    elseif activeEvents[4] and x == 54 and y == 170 then
        showMissionText(8)
        triggerEndEvent(4, 4)
    elseif activeEvents[5] and x == 172 and y == 184 then
        showMissionText(10)
        triggerEndEvent(5, 5)
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    elseif activeEvents[30] and x == 249 and y == 161 then
        triggerEndEvent(30, 30)
        triggerEndEvent(99, 30)
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    end
end

-- Generation end
