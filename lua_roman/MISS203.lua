-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0003.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = '9.Tag im 9.Monat des 4. Jahres.\n\nWir trafen gestern auf einen Fremden, der wirklich zum Fürchten aussieht. Er ist riesengroß, hat hellblaue Augen und leuchtend gelbe Haare. In einer römischen Hafenkneipe hörte ich einst von solchen Völkern hoch im Norden. Aber wie kam er hierher? Er ist sehr mißtrauisch und redet nicht mit uns. Wir werden ihn ein paar Tage als Gast bewirten (der arme Kerl scheint völlig ausgehungert zu sein). Vielleicht ändert er dann seine Meinung.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Erkunden Sie die Umgebung.',
        msg2    = '16.Tag.\n\nNa, bitte. Was ein wenig Freigiebigkeit doch alles bewirken kann. Der blonde Riese erzählte uns, daß er Angehöriger eines Volkes sei, das sich selbst als "Wikinger" bezeichnet. Es habe auf einer großen Insel nicht weit im Osten gelebt, sei aber von einem verfeindeten Stamm besiegt worden. Der Mann heißt Erik. Seltsamer Name! Von Beruf ist er, wenn man ihm glauben kann, Schiffsbauer. Mein Herz schlägt höher bei dem Gedanken, daß ich bald wieder an Bord eines Schiffes gehen könnte, das Meer unter den Planken, die Schreie der Möwen im Ohr, das Rauschen des Windes...\nAber zunächst müssen wir eine Werft und einen Hafen errichten.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Bauen Sie einen Hafen und eine Werft. Bauen Sie in der Werft ein großes Handelsschiff und starten im Hafen eine Expedition.',
        msg4    = 'Auf einer kleinen Insel in der Mitte des Archipels entdeckten wir einen riesigen Walfriedhof. Hunderte von gigantischen Skeletten. Ein imposanter Anblick. Wir konnten uns zunächst nicht erklären, wie diese Tiere dort hinkamen. Erik erklärte uns aber dann, daß sein Volk von diesen Tieren lebt und sie als heilig verehrt. Deshalb werden ihre Gebeine nach dem Fang an diesen geweihten Ort gebracht. Erik ist unwohl. Er möchte schnell wieder weg, da er die Geister der toten Tiere fürchtet.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Erkunden Sie weitere Inseln. Suchen Sie nach dem nächsten Tor.',
        msg6    = 'Wir haben das Tor erreicht und aktiviert. Der Weg ist frei.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n ',
        msgh6   = 'Sie haben diese Mission erfüllt. Das nächste Kapitel wartet schon auf Sie...',
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = 'The Ninth Day of the Ninth Month of the Fourth Year.\n\nYesterday we met a stranger of truly frightening appearance. He is huge in size, has light blue eyes and glowing golden hair. Long ago in a Roman harbor tavern I once heard stories of such people who live in the far north. How did he get here? He is suspicious and refuses to talk to us. We shall treat him as our guest for a few days (the poor fellow appears to be starving). Perhaps then he will change his attitude.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Explore the surrounding area.',
        msg2    = '16th Day of the Ninth Month of the Fourth Year.\n\nWell, what wonders a little generosity can achieve. The blond giant told us that he is a member of a race that calls itself the "Vikings". He says that they lived on a large island not far to the east but they were conquered by a hostile tribe. His name is Erik. What a strange name! If we are to believe him, he is a shipwright by trade. My heart beats faster at the prospect of soon being able to board a ship again, hearing the waves under the keel, the cries of the seagulls and the wind in the sails...\nBut first of all we must construct a shipyard and a harbor.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Build a harbor and a shipyard. In the shipyard build a large trading ship and organize an expedition from the harbor.',
        msg4    = 'On a small island in the middle of a archipelago, we discovered an enormous whale graveyard, in which there were hundreds of gigantic skeletons. What an imposing sight. At first we were unable to understand how these creatures got there. Erik explained that his people lived off these creatures and worshipped them as holy animals. This was why their bones were brought to this sacred place after they were caught. Erik is uneasy, he wants to leave because he is afraid of the spirits of the dead creatures.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Explore the island further. Search for the next gateway.',
        msg6    = 'We have reached the gateway and activated it. The way is now clear.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n ',
        msgh6   = 'You have completed this mission. The next Chapter awaits you...',
    },
    pl =
    {
        Diary   = 'Dziennik',
        msg0    = 'Dziewiąty Dzień Dziewiątego Miesiąca Czwartego Roku.\n\nNapotkaliśmy wczoraj człowieka, którego wygląd przeraził nas. Jest potężny i barczysty, o niebieskich oczach i lśniących złotem włosach. Dawno temu, w pewnej rzymskiej tawernie zdało mi się słyszeć opowieści o podobnych ludziach, mieszkających ponoć na dalekiej północy. Jakim sposobem dotarł on zatem tutaj? Jest podejrzliwy i odmawia rozmowy z nami. Będziemy traktować go jak gościa przez najbliższe kilka dni (ten biedny człowiek wygląda, jakby nic nie jadł od kilku dni). Być może wtedy stanie się bardziej przyjacielski.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh0   = 'Zwiedź najbliższą okolicę.',
        msg2    = 'Szesnasty Dzień Dziewiątego Miesiąca Czwartego Roku.\n\nJak wiele można uzyskać za pomocą odrobiny uprzejmości. Jasnowłosy olbrzym wyznał nam, że należy do rasy zwącej się dumnie Wikingami. Powiedział także, że jego lud żył dotychczas na dużej wyspie niedaleko stąd na wschód, lecz został podbity przez pewne wrogo nastawione plemię. Jasnowłosy olbrzym zwie się Eryk. Cóż za dziwne imię! Jeśli wierzyć jego słowom, jest szkutnikiem. Serce łomocze radośnie w mej piersi na samą myśl o ponownym stanięciu na pokładzie statku, o ponownym poczuciu wody pod kilem, o ponownym usłyszeniu krzyków mew, o wietrze dmącym w żagle...\nPrzedtem jednak musimy postawić stocznię oraz przystań.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh2   = 'Wybuduj przystań oraz stocznię. W stoczni wybuduj duży statek kupiecki, zaś w przystani zorganizuj wyprawę ekspedycyjną.',
        msg4    = 'Na małej wyspie, w samym środku archipelagu, odkryliśmy olbrzymi cmentarz wielorybów, na którym znajdują się dziesiątki - nie, setki! - gigantycznych szkieletów. Z początku nie potrafiliśmy wyjaśnić sobie, w jaki sposób te zwierzęta dostały się tutaj, lecz Eryk wyjaśnił nam, że jego lud czcił wieloryby jako święte zwierzęta. To dlatego ich kości zostały znoszone tu, po tym, jak zostały znalezione. Eryk nalega, aby opuścić to miejsce. Wyraźnie boi się duchów martwych zwierząt.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh4   = 'Dalej eksploruj wyspę. Szukaj kolejnej bramy.',
        msg6    = 'Dotarliśmy do kolejnej bramy i uruchomiliśmy ją. Droga wolna!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n',
        msgh6   = 'Ukończyłeś misję. Kolejny Rozdział oczekuje...',
    },
})

function getNumPlayers()
    return 3
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end

    rttr:GetPlayer(1):SetAI(3)
    rttr:GetPlayer(1):SetColor(1)
    rttr:GetPlayer(1):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(1):SetName('Erik')
 -- rttr:GetPlayer(1):SetPortrait(3)

    rttr:GetPlayer(2):SetAI(3)
    rttr:GetPlayer(2):SetColor(2)
    rttr:GetPlayer(2):SetNation(NAT_VIKINGS)
    rttr:GetPlayer(2):SetName('Knut')
 -- rttr:GetPlayer(2):SetPortrait(4)
end

function onStart(isFirstStart)
    -- world always commands
    rttr:GetWorld():SetComputerBarrier(14, 61, 75)
    rttr:GetWorld():SetComputerBarrier(13, 62, 92)
    rttr:GetWorld():SetComputerBarrier(12, 77, 37)
    rttr:GetWorld():SetComputerBarrier(12, 79, 24)

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableAllBuildings()
    rttr:GetPlayer(0):DisableBuilding(BLD_HARBORBUILDING)
    rttr:GetPlayer(0):DisableBuilding(BLD_SHIPYARD)

    -- player 1 always commands
    rttr:GetPlayer(1):EnableAllBuildings()

    -- player 2 always commands
    rttr:GetPlayer(2):EnableAllBuildings()

    -- events which need to be triggered multiple times

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[ 1] = true
    activeEvents[ 2] = true
    activeEvents[30] = true
    activeEvents[99] = true

    if isFirstStart then
        -- world firststart commands
        rttr:GetWorld():AddAnimal(8, 17, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(16, 11, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(24, 7, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(40, 7, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(45, 14, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(43, 13, SPEC_POLARBEAR)
        rttr:GetWorld():AddAnimal(13, 18, SPEC_STAG)
        rttr:GetWorld():AddAnimal(8, 45, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(7, 38, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(92, 39, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(58, 24, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(33, 25, SPEC_RABBITWHITE)
        rttr:GetWorld():AddAnimal(34, 23, SPEC_RABBITGREY)
        rttr:GetWorld():AddAnimal(32, 22, SPEC_RABBITWHITE)
        rttr:GetWorld():AddAnimal(33, 24, SPEC_FOX)
        rttr:GetWorld():AddAnimal(32, 28, SPEC_DEER)
        rttr:GetWorld():AddAnimal(27, 33, SPEC_RABBITWHITE)
        rttr:GetWorld():AddAnimal(28, 35, SPEC_RABBITGREY)
        rttr:GetWorld():AddAnimal(29, 33, SPEC_RABBITWHITE)
        rttr:GetWorld():AddAnimal(22, 25, SPEC_SHEEP)
        rttr:GetWorld():AddAnimal(10, 33, SPEC_SHEEP)

        -- player 0 firststart commands
        rttr:GetPlayer(0):PlaceHQ(16, 27)
        rttr:GetPlayer(0):ClearResources()

        -- player 1 firststart commands
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(2)
        rttr:GetPlayer(1):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(1):PlaceHQ(97, 24)
        rttr:GetPlayer(1):ClearResources()

        -- player 2 firststart commands
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(1)
        rttr:GetPlayer(2):MakeOneSidedAllianceTo(0)
        rttr:GetPlayer(2):PlaceHQ(97, 84)
        rttr:GetPlayer(2):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 25,
            [GD_BOARDS    ] = 60,
            [GD_STONES    ] = 46,
            [GD_MEAT      ] = 6,
            [GD_GRAIN     ] = 10,
            [GD_FLOUR     ] = 8,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 3,
            [GD_BREAD     ] = 6,
            [GD_WATER     ] = 25,
            [GD_BEER      ] = 8,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 33,
            [GD_GOLD      ] = 24,
            [GD_IRON      ] = 15,
            [GD_COINS     ] = 4,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 5,
            [GD_HAMMER    ] = 13,
            [GD_SHOVEL    ] = 3,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 5,
            [GD_SCYTHE    ] = 2,
            [GD_CLEAVER   ] = 3,
            [GD_ROLLINGPIN] = 1,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 3,
            [GD_SHIELD    ] = 2,
            [GD_BOAT      ] = 2,
        })

        -- player 1 wares
        rttr:GetPlayer(1):AddWares({
            [GD_WOOD      ] = 25,
            [GD_BOARDS    ] = 60,
            [GD_STONES    ] = 46,
            [GD_MEAT      ] = 6,
            [GD_GRAIN     ] = 10,
            [GD_FLOUR     ] = 8,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 3,
            [GD_BREAD     ] = 6,
            [GD_WATER     ] = 25,
            [GD_BEER      ] = 8,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 13,
            [GD_GOLD      ] = 30,
            [GD_IRON      ] = 15,
            [GD_COINS     ] = 4,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 5,
            [GD_HAMMER    ] = 13,
            [GD_SHOVEL    ] = 3,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 5,
            [GD_SCYTHE    ] = 2,
            [GD_CLEAVER   ] = 3,
            [GD_ROLLINGPIN] = 1,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 3,
            [GD_SHIELD    ] = 2,
            [GD_BOAT      ] = 2,
        })

        -- player 2 wares
        rttr:GetPlayer(2):AddWares({
            [GD_WOOD      ] = 25,
            [GD_BOARDS    ] = 60,
            [GD_STONES    ] = 46,
            [GD_MEAT      ] = 6,
            [GD_GRAIN     ] = 10,
            [GD_FLOUR     ] = 8,
            [GD_FISH      ] = 4,
            [GD_HAM       ] = 3,
            [GD_BREAD     ] = 6,
            [GD_WATER     ] = 25,
            [GD_BEER      ] = 8,
            [GD_COAL      ] = 40,
            [GD_IRONORE   ] = 33,
            [GD_GOLD      ] = 24,
            [GD_IRON      ] = 15,
            [GD_COINS     ] = 8,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 6,
            [GD_SAW       ] = 2,
            [GD_PICKAXE   ] = 5,
            [GD_HAMMER    ] = 13,
            [GD_SHOVEL    ] = 3,
            [GD_CRUCIBLE  ] = 4,
            [GD_RODANDLINE] = 5,
            [GD_SCYTHE    ] = 2,
            [GD_CLEAVER   ] = 3,
            [GD_ROLLINGPIN] = 1,
            [GD_BOW       ] = 2,
            [GD_SWORD     ] = 3,
            [GD_SHIELD    ] = 2,
            [GD_BOAT      ] = 2,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 100,
            [JOB_WOODCUTTER       ] = 4,
            [JOB_FISHER           ] = 2,
            [JOB_FORESTER         ] = 2,
            [JOB_CARPENTER        ] = 2,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 2,
            [JOB_FARMER           ] = 2,
            [JOB_MILLER           ] = 1,
            [JOB_BAKER            ] = 1,
            [JOB_BUTCHER          ] = 1,
            [JOB_MINER            ] = 6,
            [JOB_BREWER           ] = 3,
            [JOB_PIGBREEDER       ] = 1,
            [JOB_DONKEYBREEDER    ] = 2,
            [JOB_IRONFOUNDER      ] = 2,
            [JOB_MINTER           ] = 2,
            [JOB_METALWORKER      ] = 1,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 8,
            [JOB_PLANER           ] = 2,
            [JOB_GEOLOGIST        ] = 8,
            [JOB_PRIVATE          ] = 16,
            [JOB_PRIVATEFIRSTCLASS] = 6,
            [JOB_SERGEANT         ] = 4,
            [JOB_OFFICER          ] = 2,
            [JOB_GENERAL          ] = 1,
            [JOB_SCOUT            ] = 7,
            [JOB_SHIPWRIGHT       ] = 1,
            [JOB_PACKDONKEY       ] = 15,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 1 people
        rttr:GetPlayer(1):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 10,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 5,
            [JOB_CARPENTER        ] = 5,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 10,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 5,
            [JOB_BUTCHER          ] = 5,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 5,
            [JOB_PIGBREEDER       ] = 10,
            [JOB_DONKEYBREEDER    ] = 5,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 10,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 15,
            [JOB_PLANER           ] = 15,
            [JOB_GEOLOGIST        ] = 8,
            [JOB_PRIVATE          ] = 36,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 4,
            [JOB_OFFICER          ] = 2,
            [JOB_GENERAL          ] = 1,
            [JOB_SCOUT            ] = 7,
            [JOB_SHIPWRIGHT       ] = 1,
            [JOB_PACKDONKEY       ] = 15,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- player 2 people
        rttr:GetPlayer(2):AddPeople({
            [JOB_HELPER           ] = 50,
            [JOB_WOODCUTTER       ] = 10,
            [JOB_FISHER           ] = 10,
            [JOB_FORESTER         ] = 5,
            [JOB_CARPENTER        ] = 5,
            [JOB_STONEMASON       ] = 10,
            [JOB_HUNTER           ] = 10,
            [JOB_FARMER           ] = 10,
            [JOB_MILLER           ] = 10,
            [JOB_BAKER            ] = 5,
            [JOB_BUTCHER          ] = 5,
            [JOB_MINER            ] = 20,
            [JOB_BREWER           ] = 5,
            [JOB_PIGBREEDER       ] = 10,
            [JOB_DONKEYBREEDER    ] = 5,
            [JOB_IRONFOUNDER      ] = 10,
            [JOB_MINTER           ] = 10,
            [JOB_METALWORKER      ] = 5,
            [JOB_ARMORER          ] = 10,
            [JOB_BUILDER          ] = 15,
            [JOB_PLANER           ] = 15,
            [JOB_GEOLOGIST        ] = 8,
            [JOB_PRIVATE          ] = 26,
            [JOB_PRIVATEFIRSTCLASS] = 16,
            [JOB_SERGEANT         ] = 12,
            [JOB_OFFICER          ] = 8,
            [JOB_GENERAL          ] = 1,
            [JOB_SCOUT            ] = 7,
            [JOB_SHIPWRIGHT       ] = 1,
            [JOB_PACKDONKEY       ] = 15,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(0, 0)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 0 then
        showMissionText(0)
    elseif e == 1 then
        enableBuilding(BLD_HARBORBUILDING)
        enableBuilding(BLD_SHIPYARD)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(97, 68, 561, 0xFFFF, 2)
    elseif e == 99 then
        activeEvents[98] = true
        showMissionText(6)
        rttr:SetCampaignChapterCompleted('roman', 4)
        rttr:EnableCampaignChapter('roman', 5)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    end

    if p ~= 0 then return
    elseif activeEvents[2] and x == 36 and y == 47 then
        showMissionText(4)
        triggerEndEvent(2, 2)
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    elseif activeEvents[1] and x == 10 and y == 37 then
        showMissionText(2)
        triggerEndEvent(1, 1)
    elseif activeEvents[30] and x == 97 and y == 68 then
        triggerEndEvent(30, 30)
        triggerEndEvent(99, 30)
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    end
end

-- Generation end
