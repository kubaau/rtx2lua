-- Generation begin (https://github.com/kubaau/rtx2lua)

-- Original map script: MIS_0000.RTX

rttr:RegisterTranslations(
{
    de =
    {
        Diary   = 'Tagebuch',
        msg0    = 'Tagebuch des Octavius:\n\n\nVierter Tag nach dem Schiffbruch.\n\n\nGestern fanden sich alle Überlebenden zusammen, um die Lage zu beraten. Da keine Aussicht auf eine baldige Rettung besteht, beschlossen wir, uns auf dieser fremden Insel niederzulassen. Dabei werden uns die geretteten Güter aus dem Schiff eine große Hilfe sein. Das Wichtigste ist, die Rohstoffe der Insel für den Aufbau einer Siedlung nutzbar zu machen. Wir benötigen dringend Unterkünfte für einen Holzfäller, Schreiner und den Steinmetz.',
        msgh0   = 'Bauen Sie Unterkünfte für einen Holzfäller, Schreiner und Steinmetz.',
        msg2    = 'Achter Tag nach dem Schiffbruch.\n\n\nDie Grundlagen für den Aufbau unserer Siedlung sind geschaffen. Der Baumbestand in diesem Gebiet wird aber nicht lange vorhalten. Um die langfristige Versorgung mit Holz zu gewährleisten, benötigen wir einen Förster.',
        msgh2   = 'Bauen Sie ein Forsthaus.',
        msg4    = 'Elfter Tag im zweiten Monat nach dem Schiffbruch.\n\n\nWir wissen immer noch nicht, ob wir alleine auf dieser Insel sind. Vorsichtshalber sollten wir einen Wachposten an den offenen Grenzen zum Landesinneren errichten.',
        msgh4   = 'Bauen Sie eine Baracke an der nördlichen Grenze Ihrer Siedlung.',
        msg6    = 'Fünfter Tag im dritten Monat.\n\n\nDurch die Ausbreitung unseres Landes haben wir den Berg im Norden erreicht. Unser Gelehrter sollte sich dort den Boden mal anschauen. Langfristig brauchen wir Brennstoff, Baumaterial und natürlich auch Waffen und gemünztes Gold. Wir müssen also Eisenerz, Gold, Kohle und Granit finden.',
        msgh6   = 'Bauen Sie einen Weg auf den Berg und schicken Sie Ihren Gelehrten dorthin.',
        msg8    = 'Sechzehnter Tag im sechsten Monat.\n\n\nWir haben Eisenerz gefunden und wären jetzt in der Lage, Waffen zu produzieren. Der weiteren Erkundung der Insel stünde dann nichts mehr im Wege. Dazu müssen wir aber erst ein Eisenbergwerk und die dazugehörige Eisenschmelze bauen. Eine Waffenschmiede könnte dann die Produktion von Schwertern und Schilden übernehmen. Wir müssen aber auch die Bergarbeiter mit Nahrungsmitteln versorgen. Unsere Vorräte sind fast aufgebraucht. Wir brauchen Jäger und Fischer!',
        msgh8   = 'Bauen Sie ein Eisenbergwerk, eine Eisenschmelze und eine Waffenschmiede.',
        msg10   = 'Letzter Tag im achten Monat nach der Landung.\n\n\nNördlich unseres neuen Außenpostens liegt eine weite, fruchtbare Ebene. Dort ergeben sich ganz neue Möglichkeiten, unsere Siedlung zu erweitern. Dazu brauchen wir allerdings Soldaten.',
        msgh10  = 'Erreichen Sie die nördliche Ebene, indem Sie an der Nordgrenze weitere Baracken bauen.',
        msg12   = 'Zwölfter Tag des neunten Monats.\n\n\nNachdem wir weiter nach Norden vorgedrungen sind, haben wir endlich genug Platz, um größere Gebäude und Bauernhöfe errichten zu können. Jetzt wollen wir das umliegende Gebirge nach Rohstoffen absuchen.',
        msgh12  = 'Suchen Sie nach neuen Rohstoffen und sichern Sie die Nahrungsversorgung. Erkunden Sie die Insel vollständig.',
        msg14   = 'Wir haben eine Goldader erschlossen und wären nun in der Lage, in einer Münzprägerei kostbare Münzen herzustellen. So langsam wird das Leben hier beinahe heimisch komfortabel.',
        msg16   = 'Die Versorgung der Schmelzereien ist gewährleistet, denn wir haben Kohle im westlichen Gebirge gefunden. Nun können wir unsere Metallerze problemlos weiterverarbeiten. Alles entwickelt sich sehr gut.',
        msg18   = 'Da Gelehrte Granitvorkommen in den Bergen gefunden haben, ist der Nachschub an Steinen bis auf weiteres gesichert.',
        msg20   = 'Unser Gelehrter hat eine Wasserader gefunden. Nun wären wir in der Lage mit einem Brunnen Wasser zu fördern.',
        msg22   = 'Wir haben die ersten Goldmünzen geprägt und können jetzt die Ausbildung unserer Soldaten bezahlen.',
        msg24   = 'Der Bau unserer ersten Getreidefarm ist abgeschlossen. Das Getreide könnte nun in einer Mühle zu Mehl verarbeitet oder auf einem Schweinehof verfüttert werden. Die Versorgungslage würde dann immer besser.',
        msg26   = 'Unser neue Schweinehof könnte nun eine Metzgerei mit Schlachtvieh versorgen.',
        msg28   = 'Die Windmühle könnte eine Bäckerei mit ausreichend Mehl versorgen.',
        msg30   = "Ein seltsames Ding haben unsere Gelehrten entdeckt. Es sieht aus wie ein Tor. Offensichtlich waren also doch bereits Menschen vor uns auf dieser Insel. Sogar eine Inschrift in latinischen Buchstaben entdeckten sie auf dem Tor. Sie ist sehr seltsam und widersprüchlich, vielleicht ein Rätsel: 'Consiste ut procederas!' 'Laß Dich nieder, um fortzuschreiten!' Wer weiß, was das bedeutet?!",
        msg100  = 'Zweiter Tag des dreizehnten Monats nach der Landung.\n\n\nGestern begann das zweite Jahr, und wir scheinen es geschafft zu haben. Die Gelehrten berichten von seltsamen Aktivitäten am Tor. Es sieht so aus, als habe sich ein Weg geöffnet, der uns von dieser Insel wegführen kann. Das scheint der Sinn des Rätsels zu sein: Man muß sich niederlassen und siedeln, um weiterzukommen. Mal sehen. Vielleicht führen ja wirklich alle Wege nach Rom.\n\n\n\n\n\n\n\n\n',
        msgh100 = 'Sie haben diese Mission erfüllt. Das zweite Kapitel wartet schon auf Sie... \n\nWann immer Sie wollen, können Sie im Hauptmenü die nächste Mission starten.',
    },
    en =
    {
        Diary   = 'Diary',
        msg0    = 'Diary of Octavius:\n\n\nFourth Day After Shipwreck.\n\n\nYesterday all the survivors met in order to discuss the situation. Because there is no prospect of an early rescue, we decided to settle on this foreign island. The items salvaged from the ship will be a great help to us. The most important thing is to make use of the raw materials on the island in order to establish a settlement. We urgently need accommodations for a woodcutter, carpenter and stonemason.',
        msgh0   = 'Build accommodations for a woodcutter, carpenter and stonemason.',
        msg2    = 'Eighth Day After Shipwreck.\n\n\nThe basic requirements for building up our settlement have been met. However, the supply of trees in this region will not last long. We need a forester to ensure a long-term supply of timber.',
        msgh2   = 'Build a forester.',
        msg4    = 'Eleventh Day of the Second Month After Shipwreck.\n\n\nWe are still not sure whether we are the only people on this island. As a precautionary measure we should erect a barracks on our exposed border towards the interior of the island.',
        msgh4   = 'Build a barracks on the northern border of your settlement.',
        msg6    = 'Fifth Day of the Third Month.\n\n\nOur territory has spread as far as the mountain in the north. Our geologist will carry out a land survey there. In the long term we need fuel and building materials as well as weapons and coined gold. We must therefore find a source of iron ore, gold, coal and granite.',
        msgh6   = 'Build a road to the mountain and send your geologist there.',
        msg8    = 'Sixteenth Day of the Sixth Month.\n\n\nWe have found iron ore and are now able to produce weapons. There are now no obstacles to further exploration of the island. First we must construct both an iron mine and an iron smelter. An armorer can then start to produce swords and shields. We must also provide the miners with food, our stocks are almost exhausted. We need hunters and fishermen!',
        msgh8   = 'Build an iron mine, an iron smelter and an armory.',
        msg10   = 'Last Day of the Eighth Month After Coming Ashore.\n\n\nThere is an open, fertile plain to the north of our new border post. This will provide lots of new opportunities for expanding our settlement but we need more soldiers to do this.',
        msgh10  = 'Go to the northern plain and continue expanding the border.',
        msg12   = 'Twelfth Day of the Ninth Month.\n\n\nAfter advancing further north we have finally found enough space to construct larger buildings and farms. We now intend to search for raw materials in the surrounding mountains.',
        msgh12  = 'Search for new raw materials and secure a supply of food. Explore the entire island.',
        msg14   = 'We have discovered a gold vein and can now produce valuable coins in a mint. This will make life here almost as comfortable as at home.',
        msg16   = 'We have ensured a fuel supply for the metalworks by finding coal in the western mountains. Now we can process our metal ores without any problems. Everything is going extremely well.',
        msg18   = 'Geologists have found granite deposits in the mountains, this will provide a fresh supply of stone for the time being.',
        msg20   = 'Our geologist has found a spring. We are now able to supply fresh water to our settlement.',
        msg22   = 'We have minted the first gold coins and can now pay for the training of our soldiers.',
        msg24   = 'Construction of our first grain farm has been completed. The grain can either be processed into flour in a mill, or used to feed pigs. The food supply situation should now continue to improve.',
        msg26   = 'Our new pig farm can supply animals to a butcher.',
        msg28   = 'The windmill can supply a baker with sufficient flour for baking bread.',
        msg30   = 'Our scouts have discovered a strange object. It looks like a gateway. We are obviously not the first humans on this island. They have even found an inscription on the gateway in Latin. It is bizarre and contradictory, perhaps it is a riddle: "Consiste ut procederas!" - "Settle down in order to make progress!". What can this mean?',
        msg100  = 'Second Day of the Thirteenth Month After Coming Ashore.\n\n\nThe second year began yesterday and we seem to have succeeded in settling this island. The scouts report strange goings on near the gateway. It appears that a path has opened up that can lead us from this island. This seems to be the meaning of the riddle: we must settle in order to move on. We shall take a look, perhaps all roads really do lead to Rome.\n\n\n\n\n\n\n\n\n',
        msgh100 = 'You have completed this mission. The second Chapter awaits you... \n\n You can begin the next mission from the main menu whenever you want.',
    },
    pl =
    {
        Diary   = 'Dziennik',
        msg0    = 'Dziennik Oktawiana:\n\n\nCzwarty Dzień po katastrofie statku.\n\n\nDnia wczorajszego, wszyscy, którzy przetrwali, zgromadzili się, aby przedyskutować naszą obecną sytuację. Z racji, iż nie mamy perspektyw na szybki ratunek, zdecydowaliśmy, że osiądziemy na tej nieznanej wyspie. W dziele tym pomogą nam przedmioty, jakie wydobyliśmy z wraku statku. Najważniejszą rzeczą jest obecnie umiejętne wykorzystanie surowców, znajdujących się na tym lądzie. Pilnie potrzebujemy drwala, cieśli oraz kamieniarza.',
        msgh0   = 'Wybuduj kwatery dla drwala, cieśli oraz kamieniarza.',
        msg2    = 'Ósmy Dzień po katastrofie statku.\n\n\nPodstawy naszej osady zostały stworzone. Mimo to, znajdujące się w tej okolicy drzewa nie wystarczą nam na długo. Potrzebujemy leśnika, który zapewni nam długotrwałe dostawy drewna.',
        msgh2   = 'Wybuduj kwaterę dla leśnika.',
        msg4    = 'Jedenasty Dzień Drugiego Miesiąca po katastrofie statku.\n\n\nWciąż nie wiemy, czy jesteśmy jedynymi ludźmi na tej wyspie. Na wszelki wypadek powinniśmy wybudować koszary, przy naszej linii granicznej znajdującej się jak najbliżej środka wyspy.',
        msgh4   = 'Wybuduj koszary na północnej granicy twej osady.',
        msg6    = 'Piąty Dzień Trzeciego Miesiąca\n\n\nGranice naszego państwa dotarły do znajdujących się na północy gór. Nasz geolog zbada tamtejszą ziemię. Potrzebujemy paliwa oraz materiałów budowlanych, a także broni i złotych monet. Aby to uzyskać, musimy znaleźć rudy żelaza, żyły złota, pokłady węgla i granitu.',
        msgh6   = 'Wybuduj drogę w stronę gór i wyślij tam geologa.',
        msg8    = 'Szesnasty Dzień Szóstego Miesiąca.\n\n\nZnaleźliśmy rudę żelaza i możemy teraz produkować broń. Nic nie stoi teraz na przeszkodzie, aby wyruszyć w głąb wyspy. Wpierw jednak musimy wybudować kopalnię żelaza oraz hutę. Zbrojmistrz będzie mógł wtenczas rozpocząć produkcję mieczy i tarcz. Musimy także zapewnić górnikom wyżywienie, a nasze zapasy są na wyczerpaniu! Potrzebujemy myśliwych i rybaków!',
        msgh8   = 'Wybuduj kopalnię żelaza, hutę oraz zbrojownię.',
        msg10   = 'Ostatni Dzień Ósmego Miesiąca po przybiciu do brzegu.\n\n\nNa północ od nowego posterunku granicznego, znajduje się szeroka, otwarta równina. To zapewnia nam wiele nowych okazji do rozwoju naszej osady, lecz aby to zrobić, potrzebujemy więcej żołnierzy.',
        msgh10  = 'Udaj się na północ i kontynuuj poszerzanie granic.',
        msg12   = 'Dwunasty Dzień Dziewiątego Miesiąca\n\n\nPo przemieszczeniu się na północ, zdobyliśmy wreszcie wystarczająco miejsca, aby rozpocząć konstruowanie większych budynków i farm. Rozpoczynamy poszukiwanie surowców w otaczających nas górach.',
        msgh12  = 'Rozpocznij poszukiwanie surowców i zapewnij ciągłe dostawy jedzenia. Zbadaj całą wyspę.',
        msg14   = 'Odkryliśmy żyłę złota i możemy produkować cenne monety w mennicy. Życie staje się powoli znośne - wraz ze środkiem płatniczym, stanie się ono niemal tak wygodne jak w domu.',
        msg16   = 'Zapewniliśmy dostawy paliwa do zakładów metalowych poprzez odkrycie pokładów węgla w zachodnich górach. Możemy teraz przetwarzać znalezione rudy bez żadnych problemów. Wszystko idzie nam zadziwiająco dobrze.',
        msg18   = 'Geolodzy odkryli złoża granitu w górach! To zapewni nam dostawy kamienia - przynajmniej na najbliższy czas.',
        msg20   = 'Nasi geolodzy odkryli źródło. Mamy teraz świeżą wodę w naszej osadzie.',
        msg22   = 'Wyprodukowaliśmy nasze pierwsze złote monety i możemy zapłacić za trening naszych żołnierzy.',
        msg24   = 'Konstrukcja naszej pierwszej farmy została zakończona. Zboże może być przerabiane w wiatraku w mąkę, lub użyte do karmienia świń. Sytuacja dostaw jedzenia powinna się od teraz polepszać.',
        msg26   = 'Nasz nowy chlew zapewnia dostawy zwierząt dla rzeźnika.',
        msg28   = 'Wiatrak zapewnia piekarzowi dostawy odpowiednich ilości mąki do wypieku chleba.',
        msg30   = 'Nasi zwiadowcy odnaleźli przedziwny obiekt. Wygląda jak swego rodzaju brama. Wszystko wskazuje na to, że nie jesteśmy pierwszymi ludźmi, jacy dotarli na tą wyspę. Zwiadowcy odnaleźli nawet osobliwą inskrypcję, napisaną po łacinie. Jest szalona i przeczy sama sobie, chociaż może jest to zagadka? "Consiste ut procederas!" - "Osiądź w miejscu, aby posuwać się naprzód!". Co to może oznaczać?',
        msg100  = 'Drugi Dzień Trzynastego Miesiąca po przybiciu do brzegu.\n\n\nDrugi rok rozpoczął się wczoraj i wydaje się, że pomyślnie osiedliśmy na tej wyspie. Zwiadowcy zameldowali o dziwnych rzeczach, dziejących się z bramą. Jej podwoje otworzyły się i oczom naszym ukazało się zamknięte dotąd przejście. Chyba o to chodziło w tej przedziwnej zagadce: aby posunąć się naprzód, trzeba nam było osiąść w miejscu. Powinniśmy wkroczyć w to przejście. Być może wszystkie drogi naprawdę prowadzą do Rzymu.\n\n\n\n\n\n\n\n\n',
        msgh100 = 'Ukończyłeś tą misję. Drugi Rozdział oczekuje...\n\nMożesz rozpocząć drugą misję kiedy tylko zechcesz, wybierając ją z głównego menu.',
    },
})

function getNumPlayers()
    return 1
end

-- boilerplate begin
function getRequiredLuaVersion()
    return 1
end

function isMapPreviewEnabled()
    return false
end

local requiredFeature = 4
function checkVersion()
    local featureLevel = rttr:GetFeatureLevel()
    if featureLevel < requiredFeature then
        rttr:MsgBox("LUA-Version Error", "Your Return to the Roots version is outdated. The required LUA-Feature level is " .. requiredFeature .. ", your version is " .. featureLevel .. ". The script can possibly crash or run unexpectedly!\n\nPlease update the game!", true)
    end
end

local isLoading = false
function showMissionText(e)
    if isLoading then return end

    local msg = _('msg' .. tostring(e))

    if msg ~= ('msg' .. tostring(e)) then
        local msgh = _('msgh' .. tostring(e))
        if msgh ~= ('msgh'.. tostring(e)) then
            rttr:MissionStatement(0, _('Diary'), msg .. '\n\n\n\n' .. msgh)
            rttr:SetMissionGoal(0, msgh)
        else
            rttr:MissionStatement(0, _('Diary'), msg)
        end
    else
        rttr:Log("Error: no Translation found: " .. msg)
    end
end

function enableBuilding(b)
    rttr:GetPlayer(0):EnableBuilding(b, not isLoading)
end

function getAllowedChanges()
    return
    {
        ["addonsAll"]   = false,
        ["ownNation"]   = false,
        ["ownColor"]    = false,
        ["ownTeam"]     = false,
        ["aiNation"]    = false,
        ["aiColor"]     = false,
        ["aiTeam"]      = false,
    }
end

local activeEvents = {}
local eventHistory = {}
local timesTriggered = {}

function onSave(saveGame)
    saveGame:PushInt(#eventHistory)
    for i = 1, #eventHistory do
        saveGame:PushInt(eventHistory[i])
    end
    return true
end

function onLoad(saveGame)
    local n = saveGame:PopInt()
    for i = 1, n do
        eventHistory[i] = saveGame:PopInt()
    end
    return true
end

function onSettingsReady()
    checkVersion()
    rttr:Log("-----------------------\n lua loaded... \n-----------------------\n")
    rttr:ResetAddons()
    rttr:SetAddon(ADDON_CATAPULTS_ATTACK_ALLIES, true)
    rttr:SetAddon(ADDON_FRONTIER_DISTANCE_REACHABLE, true)
    rttr:SetGameSettings({
        ["fow"] = EXP_CLASSIC,
        ["teamView"] = false,
        ["lockedTeams"] = false
    })

    rttr:GetPlayer(0):SetNation(NAT_ROMANS)
    rttr:GetPlayer(0):SetColor(0)
-- boilerplate end
end

function onStart(isFirstStart)
    -- world always commands

    -- player 0 always commands
    rttr:GetPlayer(0):DisableAllBuildings()
    rttr:GetPlayer(0):EnableBuilding(BLD_WOODCUTTER, false)
    rttr:GetPlayer(0):EnableBuilding(BLD_QUARRY, false)
    rttr:GetPlayer(0):EnableBuilding(BLD_SAWMILL, false)

    -- events which need to be triggered multiple times
    timesTriggered[ 3] = 0
    timesTriggered[14] = 0

    -- events which are active right from the start
    activeEvents[ 0] = true
    activeEvents[ 1] = true
    activeEvents[ 2] = true
    activeEvents[ 3] = true
    activeEvents[ 8] = true
    activeEvents[17] = true
    activeEvents[18] = true
    activeEvents[19] = true
    activeEvents[21] = true
    activeEvents[22] = true
    activeEvents[23] = true
    activeEvents[24] = true
    activeEvents[25] = true
    activeEvents[26] = true
    activeEvents[27] = true
    activeEvents[99] = true

    if isFirstStart then
        -- world firststart commands
        rttr:GetWorld():AddAnimal(41, 44, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(41, 44, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(41, 44, SPEC_DUCK)
        rttr:GetWorld():AddAnimal(30, 36, SPEC_RABBITWHITE)
        rttr:GetWorld():AddAnimal(28, 37, SPEC_RABBITGREY)

        -- player 0 firststart commands
        rttr:GetPlayer(0):ModifyHQ(1)
        rttr:GetPlayer(0):PlaceHQ(33, 39)
        rttr:GetPlayer(0):ClearResources()

        -- player 0 wares
        rttr:GetPlayer(0):AddWares({
            [GD_WOOD      ] = 0,
            [GD_BOARDS    ] = 15,
            [GD_STONES    ] = 12,
            [GD_MEAT      ] = 0,
            [GD_GRAIN     ] = 0,
            [GD_FLOUR     ] = 0,
            [GD_FISH      ] = 2,
            [GD_HAM       ] = 2,
            [GD_BREAD     ] = 4,
            [GD_WATER     ] = 12,
            [GD_BEER      ] = 12,
            [GD_COAL      ] = 20,
            [GD_IRONORE   ] = 0,
            [GD_GOLD      ] = 0,
            [GD_IRON      ] = 0,
            [GD_COINS     ] = 0,
            [GD_TONGS     ] = 0,
            [GD_AXE       ] = 0,
            [GD_SAW       ] = 0,
            [GD_PICKAXE   ] = 0,
            [GD_HAMMER    ] = 0,
            [GD_SHOVEL    ] = 0,
            [GD_CRUCIBLE  ] = 0,
            [GD_RODANDLINE] = 0,
            [GD_SCYTHE    ] = 0,
            [GD_CLEAVER   ] = 0,
            [GD_ROLLINGPIN] = 0,
            [GD_BOW       ] = 0,
            [GD_SWORD     ] = 0,
            [GD_SHIELD    ] = 0,
            [GD_BOAT      ] = 0,
        })

        -- player 0 people
        rttr:GetPlayer(0):AddPeople({
            [JOB_HELPER           ] = 40,
            [JOB_WOODCUTTER       ] = 8,
            [JOB_FISHER           ] = 4,
            [JOB_FORESTER         ] = 4,
            [JOB_CARPENTER        ] = 3,
            [JOB_STONEMASON       ] = 4,
            [JOB_HUNTER           ] = 4,
            [JOB_FARMER           ] = 6,
            [JOB_MILLER           ] = 3,
            [JOB_BAKER            ] = 3,
            [JOB_BUTCHER          ] = 3,
            [JOB_MINER            ] = 8,
            [JOB_BREWER           ] = 0,
            [JOB_PIGBREEDER       ] = 4,
            [JOB_DONKEYBREEDER    ] = 0,
            [JOB_IRONFOUNDER      ] = 4,
            [JOB_MINTER           ] = 4,
            [JOB_METALWORKER      ] = 4,
            [JOB_ARMORER          ] = 4,
            [JOB_BUILDER          ] = 4,
            [JOB_PLANER           ] = 4,
            [JOB_GEOLOGIST        ] = 4,
            [JOB_PRIVATE          ] = 8,
            [JOB_PRIVATEFIRSTCLASS] = 0,
            [JOB_SERGEANT         ] = 0,
            [JOB_OFFICER          ] = 0,
            [JOB_GENERAL          ] = 0,
            [JOB_SCOUT            ] = 8,
            [JOB_SHIPWRIGHT       ] = 0,
            [JOB_PACKDONKEY       ] = 15,
            [JOB_BOATCARRIER      ] = 0,
            [JOB_CHARBURNER       ] = 0,
        })

        -- events which are triggered right from the start
        triggerEndEvent(8, 8)
    else
        isLoading = true
        for i = 1, #eventHistory, 2 do
            triggerEndEvent(eventHistory[i], eventHistory[i + 1])
        end
        isLoading = false
    end
end

function triggerEndEvent(e, trigger) -- events triggered from other events
    if not activeEvents[e] then return end

    if timesTriggered[e] then timesTriggered[e] = timesTriggered[e] + 1 end

    if false then -- dummy if
    elseif e == 3 and timesTriggered[3] >= 3 then
        activeEvents[4] = true
        activeEvents[7] = true
        showMissionText(2)
        enableBuilding(BLD_FORESTER)
    elseif e == 7 then
        activeEvents[15] = true
        activeEvents[16] = true
        showMissionText(4)
        enableBuilding(BLD_BARRACKS)
    elseif e == 8 then
        showMissionText(0)
    elseif e == 9 then
        enableBuilding(BLD_IRONMINE)
        enableBuilding(BLD_IRONSMELTER)
        enableBuilding(BLD_ARMORY)
        enableBuilding(BLD_HUNTER)
        enableBuilding(BLD_FISHERY)
    elseif e == 10 then
        activeEvents[11] = true
        activeEvents[12] = true
        activeEvents[13] = true
        activeEvents[14] = true
        showMissionText(8)
    elseif e == 14 and timesTriggered[14] >= 3 then
        activeEvents[20] = true
        showMissionText(10)
    elseif e == 16 then
        activeEvents[9] = true
        activeEvents[10] = true
        showMissionText(6)
    elseif e == 17 then
        enableBuilding(BLD_MINT)
        enableBuilding(BLD_GOLDMINE)
    elseif e == 18 then
        enableBuilding(BLD_COALMINE)
    elseif e == 19 then
        enableBuilding(BLD_GRANITEMINE)
    elseif e == 20 then
        enableBuilding(BLD_FARM)
    elseif e == 21 then
        enableBuilding(BLD_PIGFARM)
        enableBuilding(BLD_MILL)
    elseif e == 22 then
        enableBuilding(BLD_SLAUGHTERHOUSE)
    elseif e == 23 then
        enableBuilding(BLD_BAKERY)
    elseif e == 24 then
        enableBuilding(BLD_WELL)
    elseif e == 98 then
        rttr:GetWorld():AddStaticObject(14, 8, 561, 0xFFFF, 2)
    elseif e == 99 then
        activeEvents[98] = true
        showMissionText(100)
        rttr:SetCampaignChapterCompleted('roman', 1)
        rttr:EnableCampaignChapter('roman', 2)
    end

    if not isLoading then
        local n = #eventHistory
        eventHistory[n + 1] = e
        eventHistory[n + 2] = trigger
    end

    activeEvents[trigger] = false
end

function onGameFrame(gf)
    if activeEvents[0] and rttr:GetPlayer(0):GetBuildingCount(BLD_WOODCUTTER) >= 1 then
        triggerEndEvent(0, 0)
        triggerEndEvent(3, 0)
    end
    if activeEvents[1] and rttr:GetPlayer(0):GetBuildingCount(BLD_QUARRY) >= 1 then
        triggerEndEvent(1, 1)
        triggerEndEvent(3, 1)
    end
    if activeEvents[2] and rttr:GetPlayer(0):GetBuildingCount(BLD_SAWMILL) >= 1 then
        triggerEndEvent(2, 2)
        triggerEndEvent(3, 2)
    end
    if activeEvents[4] and rttr:GetPlayer(0):GetBuildingCount(BLD_FORESTER) >= 1 then
        triggerEndEvent(4, 4)
        triggerEndEvent(7, 4)
    end
    if activeEvents[11] and rttr:GetPlayer(0):GetBuildingCount(BLD_IRONMINE) >= 1 then
        triggerEndEvent(11, 11)
        triggerEndEvent(14, 11)
    end
    if activeEvents[12] and rttr:GetPlayer(0):GetBuildingCount(BLD_IRONSMELTER) >= 1 then
        triggerEndEvent(12, 12)
        triggerEndEvent(14, 12)
    end
    if activeEvents[13] and rttr:GetPlayer(0):GetBuildingCount(BLD_ARMORY) >= 1 then
        triggerEndEvent(13, 13)
        triggerEndEvent(14, 13)
    end
    if activeEvents[21] and rttr:GetPlayer(0):GetBuildingCount(BLD_FARM) >= 1 then
        showMissionText(24)
        triggerEndEvent(21, 21)
    end
    if activeEvents[22] and rttr:GetPlayer(0):GetBuildingCount(BLD_PIGFARM) >= 1 then
        showMissionText(26)
        triggerEndEvent(22, 22)
    end
    if activeEvents[23] and rttr:GetPlayer(0):GetBuildingCount(BLD_MILL) >= 1 then
        showMissionText(28)
        triggerEndEvent(23, 23)
    end
    if activeEvents[25] and rttr:GetPlayer(0):GetWareCount(GD_COINS) >= 1 then
        showMissionText(22)
        triggerEndEvent(25, 25)
    end
    if activeEvents[98] then
        triggerEndEvent(98, 98)
    end
end

function onExplored(p, x, y, o)
    if false then -- dummy if for onContact cases
    end

    if p ~= 0 then return
    elseif activeEvents[26] and x == 14 and y == 8 then
        showMissionText(30)
        triggerEndEvent(26, 26)
    end
end

function onOccupied(p, x, y)
    if p ~= 0 then return
    elseif activeEvents[15] and x == 34 and y == 28 then
        triggerEndEvent(15, 15)
        triggerEndEvent(16, 15)
    elseif activeEvents[20] and x == 39 and y == 19 then
        showMissionText(12)
        triggerEndEvent(20, 20)
    elseif activeEvents[27] and x == 14 and y == 8 then
        triggerEndEvent(27, 27)
        triggerEndEvent(99, 27)
    end
end

function onResourceFound(p, x, y, r, q)
    if p ~= 0 then return
    elseif activeEvents[ 9] and r == RES_IRON then
        triggerEndEvent(9, 9)
        triggerEndEvent(10, 9)
    elseif activeEvents[17] and r == RES_GOLD then
        showMissionText(14)
        triggerEndEvent(17, 17)
    elseif activeEvents[18] and r == RES_COAL then
        showMissionText(16)
        triggerEndEvent(18, 18)
    elseif activeEvents[19] and r == RES_GRANITE then
        showMissionText(18)
        triggerEndEvent(19, 19)
    elseif activeEvents[24] and r == RES_WATER then
        showMissionText(20)
        triggerEndEvent(24, 24)
    end
end

-- Generation end
